import{e,r as t,f as a}from"./vendor.596c221c.js";import{i as r}from"./app.a2d3cf95.js";import{u as o}from"./utils.062368f7.js";const n=e("notas",(()=>{const e="notas",n=t({}),d=t({Proceso:0}),l=t([{}]),u=t(1),s=a((()=>n.value.results)),i=a((()=>n.value.count)),c=a((()=>u.value)),v=a((()=>{const{Proceso:e,Lote:t}=d.value;return e>0&&t>0})),_=a((()=>l.value)),y=async()=>{try{const t=1===u.value||0===u.value?{}:{page:u.value},{data:a}=await r.get(e,{params:t});return n.value=a,a}catch(t){return console.error(t),null}},I=async e=>{try{const{data:t}=await r.get("filter_notas",{params:{text:e}});return n.value=t,t.results}catch(t){return console.error(t),null}},h=e=>{u.value=e,y()};return{keyModel:e,storeModel:d,getData:s,getCounts:i,getColumns:[{Key:"Id",Text:"Id",Width:10},{Key:"Proceso_Nombre",Text:"Proceso",Width:90},{Key:"Lote_Nombre",Text:"Lote",Width:90},{Key:"Serie",Text:"Serie",Width:10},{Key:"Fecha",Text:"Fecha",Width:10},{Key:"IsAceptado",Text:"Aceptado",Width:10}],getPageIndex:c,isValidFormModel:v,getStoreData:_,setData:y,saveData:async()=>{try{if(!v.value)return null;let e=null;if(d.value.id){const t=d.value.Serie.split("-");d.value.Serie=t[0],e=await r.put(`notas/${d.value.id}/`,d.value)}else e=await r.post("notas/",d.value);return I(""),e.data}catch(e){return console.error(e),null}},filterData:I,setById:async e=>{try{const{data:t}=await r.get(`notas/${e}/`);return t}catch(t){return console.error(t),null}},setPageIndex:h,setPrevius:()=>{u.value>1&&h(u.value-1)},setNext:()=>{const e=Math.abs(Math.ceil(i.value/o().CountPagination));u.value<e&&h(u.value+1)},clearModel:()=>{d.value={}},set_notas_sin_procesar_by_proceso:async e=>{try{const{data:t}=await r.get("notas/get_notas_sin_procesar_by_proceso",{params:{proceso_id:e}});l.value=t}catch(t){return console.error(t),null}}}})),d=e("notas_detalles",(()=>{const e="notas_detalles",o=t([]),n=t({}),d=a((()=>o.value)),l=a((()=>o.value.length>0)),u=(e,t)=>o.value.findIndex((a=>a.Unidad_Id===t&&a.Producto_Id===e))>-1;return{keyModel:e,storeModel:n,storeData:o,getData:d,getColumns:[{Key:"Producto_Nombre",Text:"Producto",Width:10,Align:"left",FormatMoney:!1},{Key:"Unidad_Nombre",Text:"Unidad",Width:10,Align:"left",FormatMoney:!1},{Key:"Cantidad",Text:"Cantidad",Width:10,Align:"right",FormatMoney:!1}],isValidFormModel:l,saveData:async t=>{try{if(!l.value)return null;let n=(a=t,o.value.filter((e=>(null==e?void 0:e.Id)>0)).map((e=>({id:e.Id,Nota:a,Producto:e.Producto_Id,Unidad:e.Unidad_Id,Cantidad:e.Cantidad,Factor:e.Factor})))),d=null;return n.length>0&&(d=await r.put(`${e}/`,n)),n=(e=>o.value.filter((e=>0===(null==e?void 0:e.Id))).map((t=>({id:0,Nota:e,Producto:t.Producto_Id,Unidad:t.Unidad_Id,Cantidad:t.Cantidad,Factor:t.Factor}))))(t),n.length>0&&(d=await r.post(`${e}/`,n)),null==d?void 0:d.data}catch(n){return console.error(n),null}var a},ExistProductoUnidad:u,addList:e=>{try{if(u(e.Producto_Id,e.Unidad_Id))return!1;const t=o.value.findIndex((t=>t===e));return-1===t?o.value.push(e):o.value[t]=e,!0}catch(t){return!1}},deleteData:async t=>{try{let a=o.value.findIndex((e=>e===t));return a>-1&&t.Id>0&&await r.delete(`${e}/${t.Id}/`),a=o.value.findIndex((e=>e.Producto_Id===t.Producto_Id&&e.Unidad_Id===t.Unidad_Id)),a>-1&&o.value.splice(a,1),!0}catch(a){return console.error(a),!1}},get_nota_detalles_by_nota_id:async e=>{try{const{data:t}=await r.get("get_nota_detalles_by_nota_id",{params:{notaId:e}});return o.value=t,t}catch(t){return console.error(t),null}},clearModel:()=>{n.value={},o.value=[]}}}));export{d as a,n as u};
