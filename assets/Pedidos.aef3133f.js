import{_ as e}from"./InputSearch.333bdd7d.js";import{_ as o}from"./auto-download.5d8456a1.js";import{a as t,_ as a,b as l}from"./DataTableComponent.44b62e10.js";import{g as r,r as s,k as i,o as d,d as n,p as u,x as c,h as p,y as m,t as v,i as f,j as b,F as g,l as h,n as w,B as y,z as x,I as P,A as M,s as _}from"./vendor.596c221c.js";/* empty css              */import{u as k,a as F}from"./pedidosDetalles.14e85c1b.js";import{u as D}from"./almacen.2e1e595a.js";import{u as N}from"./app.29cc8f05.js";import{u as B}from"./proceso.46d23f9c.js";import{u as I}from"./producto.2d74ac90.js";import{u as U}from"./utils.062368f7.js";const C={class:"row-span-2"},S={class:"text-2xl font-semibold text-black uppercase"},j={class:"text-gray-500"},A={key:0,class:"text-xs text-red-500"},E={class:"h-[100%] w-full flex flex-col"},V={class:"row-span-1"},L=["onClick"],O={class:"bg-white row-span-10 overflow-y-auto h-full w-full"},q={class:"form-container"},T=p("label",{for:"proceso",class:"form-label"},"Proceso",-1),G={key:0},R=["value"],z={key:1,class:"w-full flex flex-col"},H={class:"form-input w-full focus:text-black lg:w-[50%] bg-green-500 text-white"},K={class:"form-container"},$={key:0,class:"flex flex-col"},J=p("label",{for:"almacen",class:"form-label"},"Almacen",-1),Q=["value"],W={key:1,class:"w-full flex flex-col"},X={class:"form-input w-full focus:text-black lg:w-[50%] bg-green-500 text-white"},Y={class:"form-container"},Z=p("label",{for:"observaciones",class:"form-label"},"Observaciones",-1),ee=["disabled"],oe=p("input",{type:"submit",class:"hidden"},null,-1),te={class:"relative flex w-full items-center row-span-1"},ae={class:"form-container"},le=p("label",{for:"cantidad",class:"form-label"},"Cantidad",-1),re=m(" Agregar "),se={class:"rounded-xl overflow-auto bg-white row-span-4"},ie=["onUpdate:modelValue"],de={key:1,class:"bg-gray-200 p-2 rounded-lg text-gray-300",disabled:""},ne=r({setup(r){const ne=k(),ue=F(),ce=D(),pe=N(),me=B(),ve=I(),fe=U(),be=s(!1),ge=s({}),he=s({}),we=s({}),ye=s(!1),xe=s(0),Pe=s(!1),Me=s(0),_e=["Productos del Pedido","Pedido"],ke=s(!1);i((()=>{ne.filterData("")}));const Fe=e=>{ne.filterData(e)},De=async()=>{we.value={},he.value={},ne.clearModel(),ue.clearModel(),ce.setData();const e=await me.setProcesoActivo();if(!e)return _({title:"No tienes procesos disponibles",description:"Habra un proceso por favor! ðŸ‘ðŸ˜Š"},{type:"info",hideProgressBar:!0,position:"bottom-right"}),void(be.value=!1);he.value=e,await ve.get_productos_lotes_by_proceso_id(he.value.id,""),ne.storeModel.Proceso=e.id,ne.storeModel.Usuario=pe.getUserData.user_id,Me.value=0,fe.setFocusInput("inputSearch")},Ne=async({Id:e,Serie:o,Almacen_Id:t,Almacen_Nombre:a,Usuario_Id:l,Fecha:r,Proceso_Id:s,Proceso_Nombre:i,Observaciones:d})=>{if(!e)return void(be.value=!1);ke.value=!0,await ce.setData();const n=await me.setProcesoActivo();(null==n?void 0:n.id)!==s&&(ye.value=!0),be.value=!0,we.value={},he.value={},ne.clearModel(),ue.clearModel(),he.value.id=s,he.value.Nombre=i,ne.storeModel.id=e,ne.storeModel.Proceso=s,ne.storeModel.Serie=o,ne.storeModel.Almacen=t,ne.storeModel.Usuario=l,ne.storeModel.Fecha=r,ne.storeModel.Observaciones=d;ue.setPedidosDetallesByPedidoId(e)||_({title:"Ocurrio un problema",description:"El pedido no tiene ningun producto!"},{type:"danger",hideProgressBar:!0,position:"bottom-right"}),we.value.id=t,we.value.Nombre=a,Me.value=0,fe.setFocusInput("inputSearch"),ke.value=!1},Be=()=>ne.isValidFormModel?ue.isValidFormModel?void(Pe.value=!0):(_({title:"Formulario incompleto",description:"Por favor ingrese los productos al pedido"},{type:"info",hideProgressBar:!0,position:"bottom-right"}),void(Pe.value=!1)):(_({title:"Formulario incompleto",description:"Por favor completa todos los campos"},{type:"info",hideProgressBar:!0,position:"bottom-right"}),void(Pe.value=!1)),Ie=async()=>{if(ke.value=!0,!ne.isValidFormModel)return void _({title:"Formulario incompleto",description:"Por favor completa todos los campos"},{type:"info",hideProgressBar:!0,position:"bottom-right"});if(!ue.isValidFormModel)return void _({title:"Formulario incompleto",description:"Por favor ingrese los productos al pedido"},{type:"info",hideProgressBar:!0,position:"bottom-right"});const e=await ne.saveData();if(!e)return void _({title:"Error al guardar",description:"Por favor intenta nuevamente"},{type:"danger",hideProgressBar:!0,position:"bottom-right"});await ue.saveData(e.id)?(_({title:"Guardado",description:"Pedido guardado correctamente"},{type:"success",hideProgressBar:!0,position:"bottom-right"}),ke.value=be.value=Pe.value=!1,ne.filterData("")):_({title:"Error al guardar",description:"No se pudieron guardar los productos del pedido"},{type:"danger",hideProgressBar:!0,position:"bottom-right"})},Ue=e=>{be.value=e},Ce=async e=>{await ve.get_productos_lotes_by_proceso_id(he.value.id,e)},Se=e=>{ge.value=e,setTimeout((()=>{fe.setFocusInput("cantidad")}),100)},je=async()=>{if(!ge.value.Id)return void _({title:"Seleccione un producto",description:"Por favor!"},{type:"info",hideProgressBar:!0,position:"bottom-right"});if(!xe.value)return void _({title:"Ingrese la cantidad",description:"Por favor!"},{type:"info",hideProgressBar:!0,position:"bottom-right"});const e={Id:0,Unidad:ge.value.Unidad,UnidadText:ge.value.Unidad_Nombre,Factor:ge.value.Factor,Cantidad:xe.value,Pedido:0,Lote:ge.value.Lote,Lote_Nombre:ge.value.Lote_Nombre,Producto:ge.value.Id,Producto_Nombre:ge.value.Producto_Nombre};if(ue.ExistProductoUnidad(e.Producto,e.Unidad))return _({title:"El producto ya estÃ¡ en la lista!"},{type:"info",hideProgressBar:!0,position:"bottom-right"}),ge.value={},xe.value=0,void fe.setFocusInput("inputSearch");ue.addList(e)?(ge.value={},xe.value=0,fe.setFocusButton("inputSearch")):_({title:"No se pudo agregar el producto"},{type:"info",hideProgressBar:!0,position:"bottom-right"})},Ae=e=>{"Enter"===e.key&&je()},Ee=e=>{ue.deleteData(e)};return(r,s)=>{const i=e,_=o,k=t,F=a,D=l;return d(),n(g,null,[u(F,{columns:f(ne).getColumns,data:f(ne).getData||[],count:f(ne).getCounts,titulo:f(ne).keyModel,subtitulo:`Listado de ${f(ne).keyModel}`,"page-index":f(ne).getPageIndex,"show-modal":be.value,"modal-width":"50rem","modal-height":"50rem","show-loading":ke.value,onAddEvent:De,onUpdateEvent:Ne,onFilterEvent:Fe,onModalIsOpen:Ue},{cabecera:c((()=>[p("div",C,[p("h1",S,[m(v(f(ne).storeModel.id?"Editar":"Nuevo")+" "+v("Pedido")+" ",1),p("b",j,v(f(ne).storeModel.id),1)]),ye.value?(d(),n("div",A," Registro de solo lectura ")):b("",!0)])])),cuerpo:c((()=>[p("div",E,[p("section",V,[(d(),n(g,null,h(_e,((e,o)=>p("button",{key:o,class:w(["text-gray-600 focus:outline-none font-medium rounded-lg p-2 text-xs",{"border-green-500 border-b-2 shadow-lg transition  duration-300 ease-in-out transform hover:-translate-y-1 hover:scale-100":Me.value===o," rounded-none rounded-r-lg":0==o}]),onClick:e=>Me.value=o},v(e),11,L))),64))]),p("section",O,[p("form",{class:w(["form-container w-full h-full p-3",1==Me.value?"grid":"hidden"]),onSubmit:s[3]||(s[3]=y((()=>{}),["prevent"]))},[p("div",q,[T,ye.value?(d(),n("div",z,[p("span",H,v(he.value.Nombre),1)])):(d(),n("div",G,[x(p("select",{id:"proceso","onUpdate:modelValue":s[0]||(s[0]=e=>f(ne).storeModel.Proceso=e),class:"form-input w-full focus:text-black lg:w-[50%] bg-green-500 text-white",required:""},[(d(!0),n(g,null,h([he.value],((e,o)=>(d(),n("option",{key:o,value:e.id,class:"text-gray-700","aria-readonly":"true"},v(e.Nombre),9,R)))),128))],512),[[P,f(ne).storeModel.Proceso]])]))]),p("div",K,[ye.value?(d(),n("div",W,[p("span",X,v(we.value.Nombre),1)])):(d(),n("div",$,[J,x(p("select",{id:"almacen","onUpdate:modelValue":s[1]||(s[1]=e=>f(ne).storeModel.Almacen=e),class:"form-input w-full focus:text-black lg:w-[50%] bg-green-500 text-white",required:""},[(d(!0),n(g,null,h(f(ce).getData,((e,o)=>(d(),n("option",{key:o,value:e.id,class:"text-gray-700"},v(e.Nombre),9,Q)))),128))],512),[[P,f(ne).storeModel.Almacen]])]))]),p("div",Y,[Z,x(p("textarea",{id:"observaciones","onUpdate:modelValue":s[2]||(s[2]=e=>f(ne).storeModel.Observaciones=e),class:"form-input w-full focus:text-black bg-white text-gray-500",disabled:ye.value},null,8,ee),[[M,f(ne).storeModel.Observaciones]])]),oe],34),p("section",{class:w(["form-container h-full p-3 grid grid-rows-5",0==Me.value?"flex":"hidden"])},[p("div",te,[u(i,{field:ge.value,"place-holder":"Buscar el producto",class:"w-[50%]",data:f(ve).getProductosProcesoLote,"column-label":"Producto_Nombre",onSelected:Se,onSearch:Ce},null,8,["field","data"]),p("div",ae,[le,x(p("input",{id:"cantidad","onUpdate:modelValue":s[4]||(s[4]=e=>xe.value=e),class:"form-input w-full focus:text-black bg-white text-gray-500",type:"number",min:"0",step:"1",onKeydown:Ae},null,544),[[M,xe.value]])]),p("div",null,[p("button",{class:"btn-submit bg-white border border-blue-500 text-blue-500 text-xs flex gap-2",onClick:je},[u(_),re])])]),p("section",se,[u(k,{columns:f(ue).getColumns,data:f(ue).storeData,actions:!0,class:"row-span-4","link-id":!1,onDeleteRow:Ee},{Cantidad:c((({index:e})=>[x(p("input",{"onUpdate:modelValue":o=>f(ue).storeData[e].Cantidad=o,type:"number",class:"form-input text-center w-24"},null,8,ie),[[M,f(ue).storeData[e].Cantidad]])])),_:1},8,["columns","data"])])],2)])])])),acciones:c((()=>[ye.value?(d(),n("button",de," Solo Lectura ")):(d(),n("button",{key:0,class:"btn-submit text-white font-bold py-2 px-4 rounded-lg",onClick:Be}," Guardar "))])),_:1},8,["columns","data","count","titulo","subtitulo","page-index","show-modal","show-loading"]),u(D,{"show-modal":Pe.value,"modal-width":"20rem","modal-height":"10rem",description:"Seguro que desea guardar los datos?",onConfirm:Ie,onCancel:s[5]||(s[5]=e=>Pe.value=!1)},null,8,["show-modal"])],64)}}});export{ne as default};
