import{_ as e,a as t,b as a}from"./DataTableComponent.3e8088c0.js";import{f as o,r as l,g as r,h as s,i as d,o as i,d as n,j as u,w as c,k as p,F as v,e as g,v as m,t as f,l as h,n as b,z as y,x,K as w,y as P}from"./vendor.f30c4ba5.js";import{t as I}from"./style.cc01f69b.js";import{i as M}from"./app.51d37901.js";import{u as F}from"./utils.5428a5cd.js";import{u as C}from"./proceso.020e99df.js";import{u as N}from"./producto.c9516f85.js";import{u as _}from"./productoUnidad.3a294b7e.js";const D=o("notas",(()=>{const e="notas",t=l({}),a=l({Proceso:0}),o=l(1),s=r((()=>t.value.results)),d=r((()=>t.value.count)),i=r((()=>o.value)),n=r((()=>{const{Proceso:e}=a.value;return e>0})),u=async()=>{try{const a=1===o.value||0===o.value?{}:{page:o.value},{data:l}=await M.get(e,{params:a});return t.value=l,l}catch(a){return console.error(a),null}},c=async e=>{if(e)try{const{data:a}=await M.get("filter_notas",{params:{text:e}});return t.value=a,a}catch(a){return console.error(a),null}else c(" ")},p=e=>{o.value=e,u()};return{keyModel:e,storeModel:a,getData:s,getCounts:d,getColumns:[{Key:"id",Text:"Id",Width:10},{Key:"Proceso_Nombre",Text:"Proceso",Width:90},{Key:"Serie",Text:"Serie",Width:10},{Key:"Fecha",Text:"Fecha",Width:10},{Key:"IsAceptado",Text:"Estado",Width:10}],getPageIndex:i,isValidFormModel:n,setData:u,saveData:async()=>{try{if(!n.value)return null;let e=null;return e=a.value.id?await M.put(`notas/${a.value.id}/`,a.value):await M.post("notas/",a.value),c(""),e.data}catch(e){return console.error(e),null}},filterData:c,setById:async e=>{try{const{data:t}=await M.get(`notas/${e}/`);return t}catch(t){return console.error(t),null}},setPageIndex:p,setPrevius:()=>{o.value>1&&p(o.value-1)},setNext:()=>{const e=Math.abs(Math.ceil(d.value/F().CountPagination));o.value<e&&p(o.value+1)},clearModel:()=>{a.value={}}}})),E=o("notas_detalles",(()=>{const e="notas_detalles",t=l({}),a=l([{}]),o=l(1),s=r((()=>a.value)),d=r((()=>o.value)),i=r((()=>a.value.length>0)),n=e=>a.value.findIndex((t=>t.Producto_Id===e))>-1;return{keyModel:e,storeModel:t,getData:s,getColumns:[{Key:"Producto_Nombre",Text:"Producto",Width:90},{Key:"Unidad_Nombre",Text:"Unidad",Width:90},{Key:"Factor",Text:"Factor",Width:15},{Key:"Cantidad",Text:"Cantidad",Width:15}],getPageIndex:d,isValidFormModel:i,setNotaDetallesById:async e=>{try{const{data:t}=await M.get("get_nota_detalles_by_nota_id",{params:{notaId:e}});return a.value=t,t}catch(t){return console.error(t),null}},saveData:async t=>{try{if(!i.value)return null;let o=(e=>a.value.filter((e=>e.Nota>0)).map((t=>({id:t.Id,Nota:e,Producto:t.Producto_Id,Unidad:t.Unidad_Id,Cantidad:t.Cantidad,Factor:t.Factor}))))(t),l=null;return o.length&&(l=await M.put(`${e}/`,o)),o=(e=>a.value.filter((e=>0===e.Nota)).map((t=>({id:0,Nota:e,Producto:t.Producto_Id,Unidad:t.Unidad_Id,Cantidad:t.Cantidad,Factor:t.Factor}))))(t),o.length>0&&(l=await M.post(`${e}/`,o)),null==l?void 0:l.data}catch(o){return console.error(o),null}},ExisteProducto:n,addList:e=>{try{if(n(e.Producto_Id))return!1;const t=a.value.findIndex((t=>t===e));return-1===t?a.value.push(e):a.value[t]=e,!0}catch(t){return!1}},deleteData:async t=>{try{let o=a.value.findIndex((e=>e===t));return o>-1&&t.Id>0&&await M.delete(`${e}/${t.Id}/`),o=a.value.findIndex((e=>e.Producto_Id===t.Producto_Id)),o>-1&&a.value.splice(o,1),!0}catch(o){return console.error(o),!1}},clearModel:()=>{t.value={},a.value=[]}}})),U=g("svg",{id:"Capa_1",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",x:"0px",y:"0px",width:"170",viewBox:"0 0 512 512",style:{"enable-background":"new 0 0 512 512"},"xml:space":"preserve"},[g("g",null,[g("g",null,[g("path",{style:{fill:"#FFE0B1"},d:"M496,48H16C7.18,48,0,55.18,0,64v384c0,8.82,7.18,16,16,16h480c8.82,0,16-7.18,16-16V64\r\nC512,55.18,504.82,48,496,48z"})]),g("g",null,[g("g",null,[g("path",{style:{fill:"#5C546A"},d:"M400,416h-56c-4.422,0-8-3.578-8-8s3.578-8,8-8h56c4.422,0,8,3.578,8,8S404.422,416,400,416z"})])]),g("g",null,[g("g",null,[g("path",{style:{fill:"#8A8895"},d:"M448,416h-16c-4.422,0-8-3.578-8-8s3.578-8,8-8h16c4.422,0,8,3.578,8,8S452.422,416,448,416z"})])]),g("g",null,[g("g",null,[g("path",{style:{fill:"#5C546A"},d:"M448,352H344c-4.422,0-8-3.578-8-8s3.578-8,8-8h104c4.422,0,8,3.578,8,8S452.422,352,448,352z"})])]),g("g",null,[g("g",null,[g("path",{style:{fill:"#5C546A"},d:"M376,384h-32c-4.422,0-8-3.578-8-8s3.578-8,8-8h32c4.422,0,8,3.578,8,8S380.422,384,376,384z"})])]),g("g",null,[g("g",null,[g("path",{style:{fill:"#8A8895"},d:"M416,384h-8c-4.422,0-8-3.578-8-8s3.578-8,8-8h8c4.422,0,8,3.578,8,8S420.422,384,416,384z"})])]),g("g",null,[g("circle",{style:{fill:"#FF4F19"},cx:"360",cy:"288",r:"24"})]),g("g",null,[g("path",{style:{fill:"#9E6459"},d:"M184,48v192c0,2.773,1.438,5.344,3.797,6.805c2.359,1.469,5.297,1.578,7.781,0.352L256,216.945\r\nl60.422,30.211c1.133,0.563,2.352,0.844,3.578,0.844c1.461,0,2.922-0.398,4.203-1.195c2.359-1.461,3.797-4.031,3.797-6.805V48H184\r\nz"})])]),g("g"),g("g"),g("g"),g("g"),g("g"),g("g"),g("g"),g("g"),g("g"),g("g"),g("g"),g("g"),g("g"),g("g"),g("g")],-1),k={class:"row-span-2"},B={class:"text-2xl font-semibold text-black uppercase"},V={class:"text-gray-500"},O={class:"h-[100%] w-full flex flex-col"},S={class:"row-span-1"},K=["onClick"],T={class:"bg-white h-full row-span-10 overflow-y-auto"},j={class:"form-container mt-3 h-full"},A=g("label",{for:"txtProceso",class:"form-label"},"Proceso:",-1),W=["value"],z={class:"form-container mt-3 h-full"},$=g("label",{for:"txtOberservacÃ­on",class:"form-label"},"OberservacÃ­on:",-1),q=g("input",{type:"submit",class:"hidden"},null,-1),L={class:"row-span-2 flex items-center w-full"},H={class:"form-container w-3/12"},G=g("label",{for:"producto",class:"form-label"},"Producto",-1),R=["value"],J={class:"form-container w-3/12"},Q=g("label",{for:"producto",class:"form-label"},"Unidad",-1),X=["value"],Y={class:"form-container w-3/12"},Z=g("label",{for:"producto",class:"form-label"},"Factor",-1),ee={class:"form-container w-3/12"},te=g("label",{for:"producto",class:"form-label"},"Cantidad",-1),ae={class:"mt-4"},oe=s({setup(o){const r=D(),s=C(),M=N(),oe=E(),le=_(),re=l(!1),se=l(!1),de=F(),ie=l(0),ne=l({}),ue=l({}),ce=["Nota de Compra","Nota Detalles"],pe=l(!1),ve=l(0);d((()=>{r.filterData("")}));const ge=e=>{r.filterData(e)},me=e=>{r.setPageIndex(e)},fe=async()=>{r.clearModel(),oe.clearModel(),await s.setData(),await M.filterData(""),de.setFocusInput("txtNombre")},he=async({id:e,Serie:t,Fecha:a,IsAceptado:o,Observaciones:l,Proceso_Id:d})=>{if(!e)return void(re.value=!1);await s.setData(),await M.filterData(""),re.value=!0,r.clearModel(),oe.clearModel(),r.storeModel.id=e,r.storeModel.Serie=t,r.storeModel.Fecha=a,r.storeModel.IsAceptado=o,r.storeModel.Observaciones=l,r.storeModel.Proceso=d,de.setFocusInput("txtNombre");await oe.setNotaDetallesById(e)||I({title:"Error",description:"No se pudo cargar los detalles!"},{type:"danger",timeout:3e3,position:"bottom-right",hideProgressBar:!0})},be=async()=>{if(!r.isValidFormModel)return I({title:"Error",description:"El formulario de Notas es invÃ¡lido!"},{type:"danger",timeout:3e3,position:"bottom-right",hideProgressBar:!0}),void(pe.value=!1);if(!oe.isValidFormModel)return I({title:"Error",description:"Ingrese los detalles de las nota!"},{type:"danger",timeout:3e3,position:"bottom-right",hideProgressBar:!0}),void(pe.value=!1);se.value=!0;const e=await r.saveData();if(!e)return I({title:"Error",description:"error al guardar nota!"},{type:"danger",timeout:3e3,position:"bottom-right",hideProgressBar:!0}),void(se.value=!1);const t=e;if(!(await oe.saveData(t.id)))return I({title:"Error",description:"Ingrese los de detalles!"},{type:"danger",timeout:3e3,position:"bottom-right",hideProgressBar:!0}),void(se.value=!1);re.value=pe.value=!1,I({title:"Exitoso",description:"OperaciÃ³n completada con Ã©xito! ðŸ˜Š"},{type:"success",timeout:3e3,position:"bottom-right",hideProgressBar:!0}),se.value=!1,r.filterData("")},ye=e=>{re.value=e,ie.value=0},xe=async e=>{await oe.deleteData(e)?I({title:"Exitoso",description:"El registro se ha eliminado correctamente"},{type:"success",timeout:3e3,position:"bottom-right",hideProgressBar:!0}):I({title:"Error",description:"No se pudo eliminar el registro"},{type:"danger",timeout:3e3,position:"bottom-right",hideProgressBar:!0})};return(o,l)=>{const d=a,F=e,C=t;return i(),n(v,null,[u(F,{columns:p(r).getColumns,data:p(r).getData||[],count:p(r).getCounts,titulo:p(r).keyModel,subtitulo:`Listado de ${p(r).keyModel}`,"page-index":p(r).getPageIndex,"show-modal":re.value,"modal-width":"50rem","modal-height":"30rem",onAddEvent:fe,onUpdateEvent:he,onFilterEvent:ge,onPageIndex:me,onNext:l[12]||(l[12]=e=>p(r).setNext()),onPrevius:l[13]||(l[13]=e=>p(r).setPrevius()),onModalIsOpen:ye},{imagen:c((()=>[U])),cabecera:c((()=>[g("div",k,[g("h1",B,[m(f(p(r).storeModel.id?"Editar":"Nueva")+" "+f("Nota de Compras")+" ",1),g("b",V,f(p(r).storeModel.id),1)])])])),cuerpo:c((()=>[g("div",O,[g("section",S,[(i(),n(v,null,h(ce,((e,t)=>g("button",{key:t,class:b(["text-gray-600 focus:outline-none font-medium rounded-lg p-2 text-xs",{"border-green-500 border-b-2 shadow-lg transition  duration-300 ease-in-out transform hover:-translate-y-1 hover:scale-100":ie.value===t," rounded-none rounded-r-lg":0==t}]),onClick:e=>ie.value=t},f(e),11,K))),64))]),g("section",T,[g("form",{class:b(["form-container h-full p-3",0==ie.value?"grid":"hidden"]),onSubmit:l[3]||(l[3]=y((()=>{}),["prevent"]))},[g("div",j,[A,x(g("select",{id:"proceso","onUpdate:modelValue":l[0]||(l[0]=e=>p(r).storeModel.Proceso=e),class:"form-input w-full focus:text-black lg:w-[50%] bg-green-500 text-white",required:"",onInput:l[1]||(l[1]=e=>p(de).setFocusInput("txtNombre"))},[(i(!0),n(v,null,h(p(s).getData,((e,t)=>(i(),n("option",{key:t,value:e.id,class:"text-gray-700"},f(e.Nombre),9,W)))),128))],544),[[w,p(r).storeModel.Proceso]])]),g("div",z,[$,x(g("textarea",{id:"txtOberservacÃ­on","onUpdate:modelValue":l[2]||(l[2]=e=>p(r).storeModel.Observaciones=e),class:"form-input sm:w-full lg:w-[100%]",placeholder:"OberservacÃ­on",required:""},null,512),[[P,p(r).storeModel.Observaciones]])]),q],34),g("section",{class:b(["form-container h-full p-3 grid grid-rows-5",1==ie.value?"flex":"hidden"])},[g("div",L,[g("div",H,[G,x(g("select",{id:"producto","onUpdate:modelValue":l[4]||(l[4]=e=>ne.value=e),class:"form-input w-full focus:text-black bg-gray-500 text-white",required:"",onChange:l[5]||(l[5]=e=>{ue.value.Factor=0,p(le).setProductoUnidadByProductoId(ne.value.Id)})},[(i(!0),n(v,null,h(p(M).getData,((e,t)=>(i(),n("option",{key:t,value:e,class:"text-gray-700"},f(e.Nombre),9,R)))),128))],544),[[w,ne.value]])]),g("div",J,[Q,x(g("select",{id:"producto","onUpdate:modelValue":l[6]||(l[6]=e=>ue.value=e),class:"form-input w-full focus:text-black bg-gray-500 text-white",required:"",onInput:l[7]||(l[7]=e=>p(de).setFocusInput("txtNombre"))},[(i(!0),n(v,null,h(p(le).getData,((e,t)=>(i(),n("option",{key:t,value:e,class:"text-gray-700"},f(e.Unidad),9,X)))),128))],544),[[w,ue.value]])]),g("div",Y,[Z,x(g("input",{id:"txtfactor","onUpdate:modelValue":l[8]||(l[8]=e=>ue.value.Factor=e),autofocus:"",type:"number",class:"form-input sm:w-full lg:w-[100%]",placeholder:"factor",readonly:""},null,512),[[P,ue.value.Factor]])]),g("div",ee,[te,x(g("input",{id:"txtfactor","onUpdate:modelValue":l[9]||(l[9]=e=>ve.value=e),autofocus:"",type:"number",class:"form-input sm:w-full lg:w-[100%]",placeholder:"cantidad"},null,512),[[P,ve.value]])]),g("div",ae,[g("button",{class:"btn-submit",onClick:l[10]||(l[10]=e=>(()=>{var e;if(!ne.value)return;const t={Id:null!=(e=ne.value.Id)?e:0,Nota:0,Producto_Id:ne.value.Id,Producto_Nombre:ne.value.Nombre,Unidad_Id:ue.value.UnidadId,Unidad_Nombre:ue.value.Unidad,Factor:ue.value.Factor,Cantidad:ve.value};if(oe.ExisteProducto(t.Producto_Id))return void I({title:"Unidad Existe",description:"El Producto ya estÃ¡ en la lista! ðŸ˜Š"},{type:"danger",position:"bottom-right",hideProgressBar:!0});oe.addList(t)||I({title:"Ocurrio un problema",description:"No se pudo agregar la unidad a la lista!"},{type:"danger"}),ne.value={},ue.value={},ve.value=0})())}," aÃ±adir ")])]),u(d,{columns:p(oe).getColumns,data:p(oe).getData||[],actions:!0,class:"row-span-1","link-id":!1,onDeleteRow:xe},null,8,["columns","data"])],2)])])])),acciones:c((()=>[g("button",{class:"btn-submit text-white font-bold py-2 px-4 rounded-lg",onClick:l[11]||(l[11]=e=>r.isValidFormModel?oe.isValidFormModel?void(pe.value=!0):(I({title:"Error",description:"Ingrese1 los detalles de la nota!"},{type:"danger",timeout:3e3,position:"bottom-right",hideProgressBar:!0}),void(pe.value=!1)):(I({title:"Error",description:"El formulario de Nota es invÃ¡lido!"},{type:"danger",timeout:3e3,position:"bottom-right",hideProgressBar:!0}),void(pe.value=!1)))}," Guardar ")])),_:1},8,["columns","data","count","titulo","subtitulo","page-index","show-modal"]),u(C,{"show-modal":pe.value,"modal-width":"20rem","modal-height":"10rem",description:"Seguro que desea guardar los datos?",onConfirm:be,onCancel:l[14]||(l[14]=e=>pe.value=!1)},null,8,["show-modal"])],64)}}});export{oe as default};
