import{_ as e}from"./InputSearch.41f6a111.js";import{_ as o}from"./auto-download.09371c7b.js";import{_ as t,a,b as l}from"./DataTableComponent.a9d13bd4.js";import{g as r,r as s,l as i,o as d,d as n,q as u,x as c,i as p,F as m,h as v,y as f,t as b,j as g,m as h,n as w,B as y,z as x,K as P,A as M}from"./vendor.a51b8ffa.js";import{t as _}from"./style.7d124276.js";import{u as k,a as F}from"./pedidosDetalles.fb5b5329.js";import{u as N}from"./almacen.11cef3c2.js";import{u as B}from"./app.1c80cf5c.js";import{u as D}from"./proceso.a128cdb5.js";import{u as I}from"./producto.449856a0.js";import{u as U}from"./utils.08d0e0c0.js";const C={class:"row-span-2"},S={class:"text-2xl font-semibold text-black uppercase"},j={class:"text-gray-500"},A={key:0,class:"text-xs text-red-500"},E={class:"h-[100%] w-full flex flex-col"},V={class:"row-span-1"},L=["onClick"],O={class:"bg-white row-span-10 overflow-y-auto h-full w-full"},q={class:"form-container"},T=v("label",{for:"proceso",class:"form-label"},"Proceso",-1),G={key:0},K=["value"],R={key:1,class:"w-full flex flex-col"},z={class:"form-input w-full focus:text-black lg:w-[50%] bg-green-500 text-white"},H={class:"form-container"},$={key:0,class:"flex flex-col"},J=v("label",{for:"almacen",class:"form-label"},"Almacen",-1),Q=["value"],W={key:1,class:"w-full flex flex-col"},X={class:"form-input w-full focus:text-black lg:w-[50%] bg-green-500 text-white"},Y={class:"form-container"},Z=v("label",{for:"observaciones",class:"form-label"},"Observaciones",-1),ee=["disabled"],oe=v("input",{type:"submit",class:"hidden"},null,-1),te={class:"relative flex w-full items-center row-span-1"},ae={class:"form-container"},le=v("label",{for:"cantidad",class:"form-label"},"Cantidad",-1),re=f(" Agregar "),se={class:"rounded-xl overflow-auto bg-white row-span-4"},ie=["onUpdate:modelValue"],de={key:1,class:"bg-gray-200 p-2 rounded-lg text-gray-300",disabled:""},ne=r({setup(r){const ne=k(),ue=F(),ce=N(),pe=B(),me=D(),ve=I(),fe=U(),be=s(!1),ge=s({}),he=s({}),we=s({}),ye=s(!1),xe=s(0),Pe=s(!1),Me=s(0),_e=["Productos del Pedido","Pedido"],ke=s(!1);i((()=>{ne.filterData("")}));const Fe=e=>{ne.filterData(e)},Ne=async()=>{we.value={},he.value={},ne.clearModel(),ue.clearModel(),ce.setData();const e=await me.setProcesoActivo();if(!e)return _({title:"No tienes procesos disponibles",description:"Habra un proceso por favor! 👍😊"},{type:"info",hideProgressBar:!0,position:"bottom-right"}),void(be.value=!1);he.value=e,await ve.get_productos_lotes_by_proceso_id(he.value.id,""),ne.storeModel.Proceso=e.id,ne.storeModel.Usuario=pe.getToken().user_id,Me.value=0,fe.setFocusInput("inputSearch")},Be=async({Id:e,Serie:o,Almacen_Id:t,Almacen_Nombre:a,Usuario_Id:l,Fecha:r,Proceso_Id:s,Proceso_Nombre:i,Observaciones:d})=>{if(!e)return void(be.value=!1);ke.value=!0,await ce.setData();const n=await me.setProcesoActivo();(null==n?void 0:n.id)!==s&&(ye.value=!0),be.value=!0,we.value={},he.value={},ne.clearModel(),ue.clearModel(),he.value.id=s,he.value.Nombre=i,ne.storeModel.id=e,ne.storeModel.Proceso=s,ne.storeModel.Serie=o,ne.storeModel.Almacen=t,ne.storeModel.Usuario=l,ne.storeModel.Fecha=r,ne.storeModel.Observaciones=d;ue.setPedidosDetallesByPedidoId(e)||_({title:"Ocurrio un problema",description:"El pedido no tiene ningun producto!"},{type:"danger",hideProgressBar:!0,position:"bottom-right"}),we.value.id=t,we.value.Nombre=a,Me.value=0,fe.setFocusInput("inputSearch"),ke.value=!1},De=()=>ne.isValidFormModel?ue.isValidFormModel?void(Pe.value=!0):(_({title:"Formulario incompleto",description:"Por favor ingrese los productos al pedido"},{type:"info",hideProgressBar:!0,position:"bottom-right"}),void(Pe.value=!1)):(_({title:"Formulario incompleto",description:"Por favor completa todos los campos"},{type:"info",hideProgressBar:!0,position:"bottom-right"}),void(Pe.value=!1)),Ie=async()=>{if(ke.value=!0,!ne.isValidFormModel)return void _({title:"Formulario incompleto",description:"Por favor completa todos los campos"},{type:"info",hideProgressBar:!0,position:"bottom-right"});if(!ue.isValidFormModel)return void _({title:"Formulario incompleto",description:"Por favor ingrese los productos al pedido"},{type:"info",hideProgressBar:!0,position:"bottom-right"});const e=await ne.saveData();if(!e)return void _({title:"Error al guardar",description:"Por favor intenta nuevamente"},{type:"danger",hideProgressBar:!0,position:"bottom-right"});await ue.saveData(e.id)?(_({title:"Guardado",description:"Pedido guardado correctamente"},{type:"success",hideProgressBar:!0,position:"bottom-right"}),ke.value=be.value=Pe.value=!1,ne.filterData("")):_({title:"Error al guardar",description:"No se pudieron guardar los productos del pedido"},{type:"danger",hideProgressBar:!0,position:"bottom-right"})},Ue=e=>{be.value=e},Ce=async e=>{await ve.get_productos_lotes_by_proceso_id(he.value.id,e)},Se=e=>{ge.value=e,setTimeout((()=>{fe.setFocusInput("cantidad")}),100)},je=async()=>{if(!ge.value.Id)return void _({title:"Seleccione un producto",description:"Por favor!"},{type:"info",hideProgressBar:!0,position:"bottom-right"});if(!xe.value)return void _({title:"Ingrese la cantidad",description:"Por favor!"},{type:"info",hideProgressBar:!0,position:"bottom-right"});const e={Id:0,Unidad:ge.value.Unidad,UnidadText:ge.value.Unidad_Nombre,Factor:ge.value.Factor,Cantidad:xe.value,Pedido:0,Lote:ge.value.Lote,Lote_Nombre:ge.value.Lote_Nombre,Producto:ge.value.Id,Producto_Nombre:ge.value.Producto_Nombre};if(ue.ExistProductoUnidad(e.Producto,e.Unidad))return _({title:"El producto ya está en la lista!"},{type:"info",hideProgressBar:!0,position:"bottom-right"}),ge.value={},xe.value=0,void fe.setFocusInput("inputSearch");ue.addList(e)?(ge.value={},xe.value=0,fe.setFocusButton("inputSearch")):_({title:"No se pudo agregar el producto"},{type:"info",hideProgressBar:!0,position:"bottom-right"})},Ae=e=>{"Enter"===e.key&&je()},Ee=e=>{ue.deleteData(e)};return(r,s)=>{const i=e,_=o,k=l,F=t,N=a;return d(),n(m,null,[u(F,{columns:p(ne).getColumns,data:p(ne).getData||[],count:p(ne).getCounts,titulo:p(ne).keyModel,subtitulo:`Listado de ${p(ne).keyModel}`,"page-index":p(ne).getPageIndex,"show-modal":be.value,"modal-width":"50rem","modal-height":"90%","show-loading":ke.value,onAddEvent:Ne,onUpdateEvent:Be,onFilterEvent:Fe,onModalIsOpen:Ue},{cabecera:c((()=>[v("div",C,[v("h1",S,[f(b(p(ne).storeModel.id?"Editar":"Nuevo")+" "+b("Pedido")+" ",1),v("b",j,b(p(ne).storeModel.id),1)]),ye.value?(d(),n("div",A," Registro de solo lectura ")):g("",!0)])])),cuerpo:c((()=>[v("div",E,[v("section",V,[(d(),n(m,null,h(_e,((e,o)=>v("button",{key:o,class:w(["text-gray-600 focus:outline-none font-medium rounded-lg p-2 text-xs",{"border-green-500 border-b-2 shadow-lg transition  duration-300 ease-in-out transform hover:-translate-y-1 hover:scale-100":Me.value===o," rounded-none rounded-r-lg":0==o}]),onClick:e=>Me.value=o},b(e),11,L))),64))]),v("section",O,[v("form",{class:w(["form-container w-full h-full p-3",1==Me.value?"grid":"hidden"]),onSubmit:s[3]||(s[3]=y((()=>{}),["prevent"]))},[v("div",q,[T,ye.value?(d(),n("div",R,[v("span",z,b(he.value.Nombre),1)])):(d(),n("div",G,[x(v("select",{id:"proceso","onUpdate:modelValue":s[0]||(s[0]=e=>p(ne).storeModel.Proceso=e),class:"form-input w-full focus:text-black lg:w-[50%] bg-green-500 text-white",required:""},[(d(!0),n(m,null,h([he.value],((e,o)=>(d(),n("option",{key:o,value:e.id,class:"text-gray-700","aria-readonly":"true"},b(e.Nombre),9,K)))),128))],512),[[P,p(ne).storeModel.Proceso]])]))]),v("div",H,[ye.value?(d(),n("div",W,[v("span",X,b(we.value.Nombre),1)])):(d(),n("div",$,[J,x(v("select",{id:"almacen","onUpdate:modelValue":s[1]||(s[1]=e=>p(ne).storeModel.Almacen=e),class:"form-input w-full focus:text-black lg:w-[50%] bg-green-500 text-white",required:""},[(d(!0),n(m,null,h(p(ce).getData,((e,o)=>(d(),n("option",{key:o,value:e.id,class:"text-gray-700"},b(e.Nombre),9,Q)))),128))],512),[[P,p(ne).storeModel.Almacen]])]))]),v("div",Y,[Z,x(v("textarea",{id:"observaciones","onUpdate:modelValue":s[2]||(s[2]=e=>p(ne).storeModel.Observaciones=e),class:"form-input w-full focus:text-black bg-white text-gray-500",disabled:ye.value},null,8,ee),[[M,p(ne).storeModel.Observaciones]])]),oe],34),v("section",{class:w(["form-container h-full p-3 grid grid-rows-5",0==Me.value?"flex":"hidden"])},[v("div",te,[u(i,{field:ge.value,"place-holder":"Buscar el producto",class:"w-[50%]",data:p(ve).getProductosProcesoLote,"column-label":"Producto_Nombre",onSelected:Se,onSearch:Ce},null,8,["field","data"]),v("div",ae,[le,x(v("input",{id:"cantidad","onUpdate:modelValue":s[4]||(s[4]=e=>xe.value=e),class:"form-input w-full focus:text-black bg-white text-gray-500",type:"number",min:"0",step:"1",onKeydown:Ae},null,544),[[M,xe.value]])]),v("div",null,[v("button",{class:"btn-submit bg-white border border-blue-500 text-blue-500 text-xs flex gap-2",onClick:je},[u(_),re])])]),v("section",se,[u(k,{columns:p(ue).getColumns,data:p(ue).storeData,actions:!0,class:"row-span-4","link-id":!1,onDeleteRow:Ee},{Cantidad:c((({index:e})=>[x(v("input",{"onUpdate:modelValue":o=>p(ue).storeData[e].Cantidad=o,type:"number",class:"form-input text-center w-24"},null,8,ie),[[M,p(ue).storeData[e].Cantidad]])])),_:1},8,["columns","data"])])],2)])])])),acciones:c((()=>[ye.value?(d(),n("button",de," Solo Lectura ")):(d(),n("button",{key:0,class:"btn-submit text-white font-bold py-2 px-4 rounded-lg",onClick:De}," Guardar "))])),_:1},8,["columns","data","count","titulo","subtitulo","page-index","show-modal","show-loading"]),u(N,{"show-modal":Pe.value,"modal-width":"20rem","modal-height":"10rem",description:"Seguro que desea guardar los datos?",onConfirm:Ie,onCancel:s[5]||(s[5]=e=>Pe.value=!1)},null,8,["show-modal"])],64)}}});export{ne as default};
