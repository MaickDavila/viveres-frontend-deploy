import{_ as e,T as t}from"./DataTableComponent.c59f0328.js";import{f as a,r as o,g as l,h as r,i as s,o as n,s as d,w as u,k as i,e as c,v,t as g,d as p,l as m,n as f,F as h,z as x,x as y,K as b,y as w,j as I}from"./vendor.f30c4ba5.js";import{t as P}from"./style.cc01f69b.js";import{i as M}from"./app.7dd6c994.js";import{u as N}from"./utils.5428a5cd.js";import{u as C}from"./proceso.cfe89160.js";import{u as F}from"./producto.0c062979.js";const _=a("notas",(()=>{const e="notas",t=o({}),a=o({Proceso:0}),r=o(1),s=l((()=>t.value.results)),n=l((()=>t.value.count)),d=l((()=>r.value)),u=l((()=>{const{Proceso:e}=a.value;return e>0})),i=async()=>{try{const a=1===r.value||0===r.value?{}:{page:r.value},{data:o}=await M.get(e,{params:a});return t.value=o,o}catch(a){return console.error(a),null}},c=async e=>{if(e)try{const{data:a}=await M.get("filter_notas",{params:{text:e}});return t.value=a,a}catch(a){return console.error(a),null}else c(" ")},v=e=>{r.value=e,i()};return{keyModel:e,storeModel:a,getData:s,getCounts:n,getColumns:[{Key:"id",Text:"Id",Width:10},{Key:"Proceso_Nombre",Text:"Proceso",Width:90},{Key:"Serie",Text:"Serie",Width:10},{Key:"Fecha",Text:"Fecha",Width:10},{Key:"IsAceptado",Text:"Estado",Width:10}],getPageIndex:d,isValidFormModel:u,setData:i,saveData:async()=>{try{if(!u.value)return null;let e=null;return e=a.value.id?await M.put(`notas/${a.value.id}/`,a.value):await M.post("notas/",a.value),c(""),e.data}catch(e){return console.error(e),null}},filterData:c,setById:async e=>{try{const{data:t}=await M.get(`notas/${e}/`);return t}catch(t){return console.error(t),null}},setPageIndex:v,setPrevius:()=>{r.value>1&&v(r.value-1)},setNext:()=>{const e=Math.abs(Math.ceil(n.value/N().CountPagination));r.value<e&&v(r.value+1)},clearModel:()=>{a.value={}}}})),D=a("notas_detalles",(()=>{const e="notas_detalles",t=o({}),a=o([{}]),r=o(1),s=l((()=>a.value)),n=l((()=>r.value)),d=l((()=>{const{Producto:e,Nota:a,Unidad:o,Cantidad:l}=t.value;return e>0&&a>0&&o>0&&l>0})),u=e=>a.value.findIndex((t=>t.Producto_Id===e))>-1;return{keyModel:e,storeModel:t,getData:s,getColumns:[{Key:"Producto_Nombre",Text:"Producto",Width:90},{Key:"Unidad_Nombre",Text:"Unidad",Width:90},{Key:"Factor",Text:"Factor",Width:15},{Key:"Cantidad",Text:"Cantidad",Width:15}],getPageIndex:n,isValidFormModel:d,setNotaDetallesById:async e=>{try{const{data:t}=await M.get("get_nota_detalles_by_nota_id",{params:{notaId:e}});return a.value=t,t}catch(t){return console.error(t),null}},saveData:async()=>{try{if(!d.value)return null;let a=null;return a=t.value.id?await M.put(`${e}/${t.value.id}/`,t.value):await M.post(`${e}/`,t.value),a.data}catch(a){return console.error(a),null}},ExisteProducto:u,addList:e=>{try{if(u(e.Producto_Id))return!1;const t=a.value.findIndex((t=>t===e));return-1===t?a.value.push(e):a.value[t]=e,!0}catch(t){return!1}},deleteData:async t=>{try{let o=a.value.findIndex((e=>e===t));return o>-1&&t.Id>0&&await M.delete(`${e}/${t.Id}/`),o=a.value.findIndex((e=>e.Producto_Id===t.Producto_Id)),o>-1&&a.value.splice(o,1),!0}catch(o){return console.error(o),!1}},clearModel:()=>{t.value={},a.value=[]}}})),k=c("svg",{id:"Capa_1",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",x:"0px",y:"0px",width:"170",viewBox:"0 0 512 512",style:{"enable-background":"new 0 0 512 512"},"xml:space":"preserve"},[c("g",null,[c("g",null,[c("path",{style:{fill:"#FFE0B1"},d:"M496,48H16C7.18,48,0,55.18,0,64v384c0,8.82,7.18,16,16,16h480c8.82,0,16-7.18,16-16V64\r\nC512,55.18,504.82,48,496,48z"})]),c("g",null,[c("g",null,[c("path",{style:{fill:"#5C546A"},d:"M400,416h-56c-4.422,0-8-3.578-8-8s3.578-8,8-8h56c4.422,0,8,3.578,8,8S404.422,416,400,416z"})])]),c("g",null,[c("g",null,[c("path",{style:{fill:"#8A8895"},d:"M448,416h-16c-4.422,0-8-3.578-8-8s3.578-8,8-8h16c4.422,0,8,3.578,8,8S452.422,416,448,416z"})])]),c("g",null,[c("g",null,[c("path",{style:{fill:"#5C546A"},d:"M448,352H344c-4.422,0-8-3.578-8-8s3.578-8,8-8h104c4.422,0,8,3.578,8,8S452.422,352,448,352z"})])]),c("g",null,[c("g",null,[c("path",{style:{fill:"#5C546A"},d:"M376,384h-32c-4.422,0-8-3.578-8-8s3.578-8,8-8h32c4.422,0,8,3.578,8,8S380.422,384,376,384z"})])]),c("g",null,[c("g",null,[c("path",{style:{fill:"#8A8895"},d:"M416,384h-8c-4.422,0-8-3.578-8-8s3.578-8,8-8h8c4.422,0,8,3.578,8,8S420.422,384,416,384z"})])]),c("g",null,[c("circle",{style:{fill:"#FF4F19"},cx:"360",cy:"288",r:"24"})]),c("g",null,[c("path",{style:{fill:"#9E6459"},d:"M184,48v192c0,2.773,1.438,5.344,3.797,6.805c2.359,1.469,5.297,1.578,7.781,0.352L256,216.945\r\nl60.422,30.211c1.133,0.563,2.352,0.844,3.578,0.844c1.461,0,2.922-0.398,4.203-1.195c2.359-1.461,3.797-4.031,3.797-6.805V48H184\r\nz"})])]),c("g"),c("g"),c("g"),c("g"),c("g"),c("g"),c("g"),c("g"),c("g"),c("g"),c("g"),c("g"),c("g"),c("g"),c("g")],-1),E={class:"row-span-2"},S={class:"text-2xl font-semibold text-black uppercase"},T={class:"text-gray-500"},K={class:"h-[100%] w-full flex flex-col"},O={class:"row-span-1"},A=["onClick"],U={class:"bg-white h-full row-span-10 overflow-y-auto"},W={class:"form-container mt-3 h-full"},j=c("label",{for:"txtProceso",class:"form-label"},"Proceso:",-1),z=["value"],B={class:"form-container mt-3 h-full"},V=c("label",{for:"txtOberservacÃ­on",class:"form-label"},"OberservacÃ­on:",-1),$=c("input",{type:"submit",class:"hidden"},null,-1),L={class:"row-span-1 flex items-center w-full"},q={class:"form-container w-3/12"},H=c("label",{for:"unidad",class:"form-label"},"Producto",-1),G=["value"],J={class:"mt-4"},Q=r({setup(a){const l=_(),r=C(),M=F(),Q=D(),R=o(!1),X=N(),Y=o(0),Z=o({}),ee=["Nota de Compra","Nota Detalles"],te=o({}),ae=o(!1);s((()=>{l.filterData("")}));const oe=e=>{l.filterData(e)},le=e=>{l.setPageIndex(e)},re=async()=>{l.clearModel(),await r.setData(),await M.filterData(""),X.setFocusInput("txtNombre")},se=async({id:e,Serie:t,Fecha:a,IsAceptado:o,Observaciones:s,Proceso_Id:n})=>{if(!e)return void(R.value=!1);await r.setData(),R.value=!0,l.clearModel(),l.storeModel.id=e,l.storeModel.Serie=t,l.storeModel.Fecha=a,l.storeModel.IsAceptado=o,l.storeModel.Observaciones=s,l.storeModel.Proceso=n,X.setFocusInput("txtNombre");await Q.setNotaDetallesById(e)||P({title:"Error",description:"No se pudo cargar los detalles!"},{type:"danger",timeout:3e3,position:"bottom-right",hideProgressBar:!0})},ne=async()=>{let e="",t="",a=!0;if(l.isValidFormModel){await l.saveData()?(e="Exitoso",t="El registro se ha guardado correctamente",R.value=!1):(e="Error",t="No se pudo guardar el registro")}else e="Error",t="Ingrese los valores del Formulario",a=!1;P({title:e,description:t},{type:a?"success":"danger",timeout:3e3,position:"bottom-right",hideProgressBar:!0})},de=e=>{R.value=e};return(a,o)=>{const s=e;return n(),d(s,{columns:i(l).getColumns,data:i(l).getData||[],count:i(l).getCounts,titulo:i(l).keyModel,subtitulo:`Listado de ${i(l).keyModel}`,"page-index":i(l).getPageIndex,"show-modal":R.value,"modal-width":"50rem","modal-height":"50rem","confirm-modal":ae.value,onAddEvent:re,onUpdateEvent:se,onFilterEvent:oe,onPageIndex:le,onNext:o[8]||(o[8]=e=>i(l).setNext()),onPrevius:o[9]||(o[9]=e=>i(l).setPrevius()),onModalIsOpen:de},{imagen:u((()=>[k])),cabecera:u((()=>[c("div",E,[c("h1",S,[v(g(i(l).storeModel.id?"Editar":"Nueva")+" "+g("Nota de Compras")+" ",1),c("b",T,g(i(l).storeModel.id),1)])])])),cuerpo:u((()=>[c("div",K,[c("section",O,[(n(),p(h,null,m(ee,((e,t)=>c("button",{key:t,class:f(["text-gray-600 focus:outline-none font-medium rounded-lg p-2 text-xs",{"border-green-500 border-b-2 shadow-lg transition  duration-300 ease-in-out transform hover:-translate-y-1 hover:scale-100":Y.value===t," rounded-none rounded-r-lg":0==t}]),onClick:e=>Y.value=t},g(e),11,A))),64))]),c("section",U,[c("form",{class:f(["form-container h-full p-3",0==Y.value?"grid":"hidden"]),onSubmit:o[3]||(o[3]=x((()=>{}),["prevent"]))},[c("div",W,[j,y(c("select",{id:"proceso","onUpdate:modelValue":o[0]||(o[0]=e=>i(l).storeModel.Proceso=e),class:"form-input w-full focus:text-black lg:w-[50%] bg-green-500 text-white",required:"",onInput:o[1]||(o[1]=e=>i(X).setFocusInput("txtNombre"))},[(n(!0),p(h,null,m(i(r).getData,((e,t)=>(n(),p("option",{key:t,value:e.id,class:"text-gray-700"},g(e.Nombre),9,z)))),128))],544),[[b,i(l).storeModel.Proceso]])]),c("div",B,[V,y(c("textarea",{id:"txtOberservacÃ­on","onUpdate:modelValue":o[2]||(o[2]=e=>i(l).storeModel.Observaciones=e),class:"form-input sm:w-full lg:w-[100%]",placeholder:"OberservacÃ­on",required:""},null,512),[[w,i(l).storeModel.Observaciones]])]),$],34),c("form",{class:f(["form-container h-full p-3",1==Y.value?"flex":"hidden"]),onSubmit:o[7]||(o[7]=x((()=>{}),["prevent"]))},[c("div",L,[c("div",q,[H,y(c("select",{id:"unidad","onUpdate:modelValue":o[4]||(o[4]=e=>Z.value=e),class:"form-input w-full focus:text-black bg-gray-500 text-white",required:"",onInput:o[5]||(o[5]=e=>i(X).setFocusInput("txtNombre"))},[(n(!0),p(h,null,m(i(M).getData,((e,t)=>(n(),p("option",{key:t,value:e,class:"text-gray-700"},g(e.Nombre),9,G)))),128))],544),[[b,Z.value]])]),c("div",J,[c("button",{class:"btn-submit",onClick:o[6]||(o[6]=e=>(()=>{var e;if(!Z.value)return;const t={Nota:null!=(e=te.value.Id)?e:0,Producto_Id:Z.value.id,Producto_Nombre:Z.value.Nombre,Unidad:1,Factor:0,Cantidad:0};if(Q.ExisteProducto(t.Producto_Id))return void P({title:"Unidad Existe",description:"La unidad ya estÃ¡ en la lista! ðŸ˜Š"},{type:"danger",position:"bottom-right",hideProgressBar:!0});Q.addList(t)||P({title:"Ocurrio un problema",description:"No se pudo agregar la unidad a la lista!"},{type:"danger"}),Z.value={}})())}," aÃ±adir ")])]),I(t,{columns:i(Q).getColumns,data:i(Q).getData||[],action:!0,class:"row-sapn-4"},null,8,["columns","data"])],34)])])])),acciones:u((()=>[c("button",{class:"btn-submit text-white font-bold py-2 px-4 rounded-lg",onClick:ne}," Guardar ")])),_:1},8,["columns","data","count","titulo","subtitulo","page-index","show-modal","confirm-modal"])}}});export{Q as default};
