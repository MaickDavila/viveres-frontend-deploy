import{u as e,_ as t,b as a}from"./DataTableComponent.64a02618.js";import{f as o,r as l,g as r,h as s,i as n,o as d,s as u,w as i,k as c,e as v,v as g,t as p,d as m,l as f,n as h,F as x,z as y,x as b,K as w,y as I,j as P}from"./vendor.f30c4ba5.js";import{t as M}from"./style.cc01f69b.js";import{i as N}from"./app.a9edc286.js";import{u as C}from"./proceso.5a4287ff.js";import{u as F}from"./producto.d33618ac.js";const _=o("notas",(()=>{const t="notas",a=l({}),o=l({Proceso:0}),s=l(1),n=r((()=>a.value.results)),d=r((()=>a.value.count)),u=r((()=>s.value)),i=r((()=>{const{Proceso:e}=o.value;return e>0})),c=async()=>{try{const e=1===s.value||0===s.value?{}:{page:s.value},{data:o}=await N.get(t,{params:e});return a.value=o,o}catch(e){return console.error(e),null}},v=async e=>{if(e)try{const{data:t}=await N.get("filter_notas",{params:{text:e}});return a.value=t,t}catch(t){return console.error(t),null}else v(" ")},g=e=>{s.value=e,c()};return{keyModel:t,storeModel:o,getData:n,getCounts:d,getColumns:[{Key:"id",Text:"Id",Width:10},{Key:"Proceso_Nombre",Text:"Proceso",Width:90},{Key:"Serie",Text:"Serie",Width:10},{Key:"Fecha",Text:"Fecha",Width:10},{Key:"IsAceptado",Text:"Estado",Width:10}],getPageIndex:u,isValidFormModel:i,setData:c,saveData:async()=>{try{if(!i.value)return null;let e=null;return e=o.value.id?await N.put(`notas/${o.value.id}/`,o.value):await N.post("notas/",o.value),v(""),e.data}catch(e){return console.error(e),null}},filterData:v,setById:async e=>{try{const{data:t}=await N.get(`notas/${e}/`);return t}catch(t){return console.error(t),null}},setPageIndex:g,setPrevius:()=>{s.value>1&&g(s.value-1)},setNext:()=>{const t=Math.abs(Math.ceil(d.value/e().CountPagination));s.value<t&&g(s.value+1)},clearModel:()=>{o.value={}}}})),D=o("notas_detalles",(()=>{const e="notas_detalles",t=l({}),a=l([{}]),o=l(1),s=r((()=>a.value)),n=r((()=>o.value)),d=r((()=>{const{Producto:e,Nota:a,Unidad:o,Cantidad:l}=t.value;return e>0&&a>0&&o>0&&l>0})),u=e=>a.value.findIndex((t=>t.Producto_Id===e))>-1;return{keyModel:e,storeModel:t,getData:s,getColumns:[{Key:"Producto_Nombre",Text:"Producto",Width:90},{Key:"Unidad_Nombre",Text:"Unidad",Width:90},{Key:"Factor",Text:"Factor",Width:15},{Key:"Cantidad",Text:"Cantidad",Width:15}],getPageIndex:n,isValidFormModel:d,setNotaDetallesById:async e=>{try{const{data:t}=await N.get("get_nota_detalles_by_nota_id",{params:{notaId:e}});return a.value=t,t}catch(t){return console.error(t),null}},saveData:async()=>{try{if(!d.value)return null;let a=null;return a=t.value.id?await N.put(`${e}/${t.value.id}/`,t.value):await N.post(`${e}/`,t.value),a.data}catch(a){return console.error(a),null}},ExisteProducto:u,addList:e=>{try{if(u(e.Producto_Id))return!1;const t=a.value.findIndex((t=>t===e));return-1===t?a.value.push(e):a.value[t]=e,!0}catch(t){return!1}},deleteData:async t=>{try{let o=a.value.findIndex((e=>e===t));return o>-1&&t.Id>0&&await N.delete(`${e}/${t.Id}/`),o=a.value.findIndex((e=>e.Producto_Id===t.Producto_Id)),o>-1&&a.value.splice(o,1),!0}catch(o){return console.error(o),!1}},clearModel:()=>{t.value={},a.value=[]}}})),k=v("svg",{id:"Capa_1",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",x:"0px",y:"0px",width:"170",viewBox:"0 0 512 512",style:{"enable-background":"new 0 0 512 512"},"xml:space":"preserve"},[v("g",null,[v("g",null,[v("path",{style:{fill:"#FFE0B1"},d:"M496,48H16C7.18,48,0,55.18,0,64v384c0,8.82,7.18,16,16,16h480c8.82,0,16-7.18,16-16V64\r\nC512,55.18,504.82,48,496,48z"})]),v("g",null,[v("g",null,[v("path",{style:{fill:"#5C546A"},d:"M400,416h-56c-4.422,0-8-3.578-8-8s3.578-8,8-8h56c4.422,0,8,3.578,8,8S404.422,416,400,416z"})])]),v("g",null,[v("g",null,[v("path",{style:{fill:"#8A8895"},d:"M448,416h-16c-4.422,0-8-3.578-8-8s3.578-8,8-8h16c4.422,0,8,3.578,8,8S452.422,416,448,416z"})])]),v("g",null,[v("g",null,[v("path",{style:{fill:"#5C546A"},d:"M448,352H344c-4.422,0-8-3.578-8-8s3.578-8,8-8h104c4.422,0,8,3.578,8,8S452.422,352,448,352z"})])]),v("g",null,[v("g",null,[v("path",{style:{fill:"#5C546A"},d:"M376,384h-32c-4.422,0-8-3.578-8-8s3.578-8,8-8h32c4.422,0,8,3.578,8,8S380.422,384,376,384z"})])]),v("g",null,[v("g",null,[v("path",{style:{fill:"#8A8895"},d:"M416,384h-8c-4.422,0-8-3.578-8-8s3.578-8,8-8h8c4.422,0,8,3.578,8,8S420.422,384,416,384z"})])]),v("g",null,[v("circle",{style:{fill:"#FF4F19"},cx:"360",cy:"288",r:"24"})]),v("g",null,[v("path",{style:{fill:"#9E6459"},d:"M184,48v192c0,2.773,1.438,5.344,3.797,6.805c2.359,1.469,5.297,1.578,7.781,0.352L256,216.945\r\nl60.422,30.211c1.133,0.563,2.352,0.844,3.578,0.844c1.461,0,2.922-0.398,4.203-1.195c2.359-1.461,3.797-4.031,3.797-6.805V48H184\r\nz"})])]),v("g"),v("g"),v("g"),v("g"),v("g"),v("g"),v("g"),v("g"),v("g"),v("g"),v("g"),v("g"),v("g"),v("g"),v("g")],-1),E={class:"row-span-2"},S={class:"text-2xl font-semibold text-black uppercase"},K={class:"text-gray-500"},O={class:"h-[100%] w-full flex flex-col"},T={class:"row-span-1"},A=["onClick"],U={class:"bg-white h-full row-span-10 overflow-y-auto"},W={class:"form-container mt-3 h-full"},z=v("label",{for:"txtProceso",class:"form-label"},"Proceso:",-1),B=["value"],V={class:"form-container mt-3 h-full"},$=v("label",{for:"txtOberservacÃ­on",class:"form-label"},"OberservacÃ­on:",-1),j=v("input",{type:"submit",class:"hidden"},null,-1),L={class:"row-span-1 flex items-center w-full"},q={class:"form-container w-3/12"},H=v("label",{for:"unidad",class:"form-label"},"Producto",-1),G=["value"],J={class:"mt-4"},Q=s({setup(o){const r=_(),s=C(),N=F(),Q=D(),R=l(!1),X=e(),Y=l(0),Z=l({}),ee=["Nota de Compra","Nota Detalles"],te=l({}),ae=l(!1);n((()=>{r.filterData("")}));const oe=e=>{r.filterData(e)},le=e=>{r.setPageIndex(e)},re=async()=>{r.clearModel(),await s.setData(),await N.filterData(""),X.setFocusInput("txtNombre")},se=async({id:e,Serie:t,Fecha:a,IsAceptado:o,Observaciones:l,Proceso_Id:n})=>{if(!e)return void(R.value=!1);await s.setData(),R.value=!0,r.clearModel(),r.storeModel.id=e,r.storeModel.Serie=t,r.storeModel.Fecha=a,r.storeModel.IsAceptado=o,r.storeModel.Observaciones=l,r.storeModel.Proceso=n,X.setFocusInput("txtNombre");await Q.setNotaDetallesById(e)||M({title:"Error",description:"No se pudo cargar los detalles!"},{type:"danger",timeout:3e3,position:"bottom-right",hideProgressBar:!0})},ne=async()=>{let e="",t="",a=!0;if(r.isValidFormModel){await r.saveData()?(e="Exitoso",t="El registro se ha guardado correctamente",R.value=!1):(e="Error",t="No se pudo guardar el registro")}else e="Error",t="Ingrese los valores del Formulario",a=!1;M({title:e,description:t},{type:a?"success":"danger",timeout:3e3,position:"bottom-right",hideProgressBar:!0})},de=e=>{R.value=e};return(e,o)=>{const l=t;return d(),u(l,{columns:c(r).getColumns,data:c(r).getData||[],count:c(r).getCounts,titulo:c(r).keyModel,subtitulo:`Listado de ${c(r).keyModel}`,"page-index":c(r).getPageIndex,"show-modal":R.value,"modal-width":"50rem","modal-height":"50rem","confirm-modal":ae.value,onAddEvent:re,onUpdateEvent:se,onFilterEvent:oe,onPageIndex:le,onNext:o[8]||(o[8]=e=>c(r).setNext()),onPrevius:o[9]||(o[9]=e=>c(r).setPrevius()),onModalIsOpen:de},{imagen:i((()=>[k])),cabecera:i((()=>[v("div",E,[v("h1",S,[g(p(c(r).storeModel.id?"Editar":"Nueva")+" "+p("Nota de Compras")+" ",1),v("b",K,p(c(r).storeModel.id),1)])])])),cuerpo:i((()=>[v("div",O,[v("section",T,[(d(),m(x,null,f(ee,((e,t)=>v("button",{key:t,class:h(["text-gray-600 focus:outline-none font-medium rounded-lg p-2 text-xs",{"border-green-500 border-b-2 shadow-lg transition  duration-300 ease-in-out transform hover:-translate-y-1 hover:scale-100":Y.value===t," rounded-none rounded-r-lg":0==t}]),onClick:e=>Y.value=t},p(e),11,A))),64))]),v("section",U,[v("form",{class:h(["form-container h-full p-3",0==Y.value?"grid":"hidden"]),onSubmit:o[3]||(o[3]=y((()=>{}),["prevent"]))},[v("div",W,[z,b(v("select",{id:"proceso","onUpdate:modelValue":o[0]||(o[0]=e=>c(r).storeModel.Proceso=e),class:"form-input w-full focus:text-black lg:w-[50%] bg-green-500 text-white",required:"",onInput:o[1]||(o[1]=e=>c(X).setFocusInput("txtNombre"))},[(d(!0),m(x,null,f(c(s).getData,((e,t)=>(d(),m("option",{key:t,value:e.id,class:"text-gray-700"},p(e.Nombre),9,B)))),128))],544),[[w,c(r).storeModel.Proceso]])]),v("div",V,[$,b(v("textarea",{id:"txtOberservacÃ­on","onUpdate:modelValue":o[2]||(o[2]=e=>c(r).storeModel.Observaciones=e),class:"form-input sm:w-full lg:w-[100%]",placeholder:"OberservacÃ­on",required:""},null,512),[[I,c(r).storeModel.Observaciones]])]),j],34),v("form",{class:h(["form-container h-full p-3",1==Y.value?"flex":"hidden"]),onSubmit:o[7]||(o[7]=y((()=>{}),["prevent"]))},[v("div",L,[v("div",q,[H,b(v("select",{id:"unidad","onUpdate:modelValue":o[4]||(o[4]=e=>Z.value=e),class:"form-input w-full focus:text-black bg-gray-500 text-white",required:"",onInput:o[5]||(o[5]=e=>c(X).setFocusInput("txtNombre"))},[(d(!0),m(x,null,f(c(N).getData,((e,t)=>(d(),m("option",{key:t,value:e,class:"text-gray-700"},p(e.Nombre),9,G)))),128))],544),[[w,Z.value]])]),v("div",J,[v("button",{class:"btn-submit",onClick:o[6]||(o[6]=e=>(()=>{var e;if(!Z.value)return;const t={Nota:null!=(e=te.value.Id)?e:0,Producto_Id:Z.value.id,Producto_Nombre:Z.value.Nombre,Unidad:1,Factor:0,Cantidad:0};if(Q.ExisteProducto(t.Producto_Id))return void M({title:"Unidad Existe",description:"La unidad ya estÃ¡ en la lista! ðŸ˜Š"},{type:"danger",position:"bottom-right",hideProgressBar:!0});Q.addList(t)||M({title:"Ocurrio un problema",description:"No se pudo agregar la unidad a la lista!"},{type:"danger"}),Z.value={}})())}," aÃ±adir ")])]),P(a,{columns:c(Q).getColumns,data:c(Q).getData||[],action:!0,class:"row-sapn-4"},null,8,["columns","data"])],34)])])])),acciones:i((()=>[v("button",{class:"btn-submit text-white font-bold py-2 px-4 rounded-lg",onClick:ne}," Guardar ")])),_:1},8,["columns","data","count","titulo","subtitulo","page-index","show-modal","confirm-modal"])}}});export{Q as default};
