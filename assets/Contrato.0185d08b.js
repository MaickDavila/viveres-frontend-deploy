import{a as e,_ as t}from"./DataTableComponent.cb6a3736.js";import{e as o,r as a,f as r,g as l,k as s,o as d,w as n,x as i,h as c,y as u,t as p,i as m,d as v,l as g,F as f,n as h,B as b,z as x,I as P,A as y,p as _,s as w}from"./vendor.596c221c.js";/* empty css              */import{i as I}from"./app.649779bd.js";import{u as M}from"./utils.062368f7.js";import{u as D}from"./proceso.f9f9c644.js";import{u as C,a as U}from"./notasDetalles.821ccbd0.js";import{u as N}from"./proveedor.ecdc7fb5.js";const F=o("proceso_lotes",(()=>{const e="proceso_lotes",t=a({}),o=a({}),l=a([{}]),s=a(1),d=r((()=>l.value)),n=r((()=>l.value.length)),i=r((()=>s.value)),c=r((()=>{const{Proceso:e}=t.value;return e>0})),u=async()=>{try{const t=1===s.value||0===s.value?{}:{page:s.value},{data:a}=await I.get(e,{params:t});return o.value=a,a}catch(t){return console.error(t),null}},p=async e=>{if(e)try{const{data:t}=await I.get("filter_proceso_lotes",{params:{text:e}});return l.value=t,t}catch(t){return console.error(t),null}else p(" ")},m=e=>{s.value=e,u()};return{keyModel:e,storeModel:t,getData:d,getCounts:n,getColumns:[{Key:"Id",Text:"Id",Width:10},{Key:"Proceso_Nombre",Text:"Proceso",Width:90},{Key:"Nota_Nombre",Text:"ODC",Width:90},{Key:"Lote_Nombre",Text:"Lote",Width:60},{Key:"Proveedor_Nombre",Text:"Proveedor",Width:60}],getPageIndex:i,isValidFormModel:c,setData:u,saveData:async()=>{try{if(!c.value)return null;let o=null;return o=t.value.id?await I.put(`${e}/${t.value.id}/`,t.value):await I.post(`${e}/`,t.value),u(),o.data}catch(o){return console.error(o),null}},filterData:p,setById:async t=>{try{const{data:o}=await I.get(`${e}/${t}/`);return o}catch(o){return console.error(o),null}},setPageIndex:m,setPrevius:()=>{s.value>1&&m(s.value-1)},setNext:()=>{const e=Math.abs(Math.ceil(n.value/M().CountPagination));s.value<e&&m(s.value+1)},clearModel:()=>{t.value={}}}})),E=o("proceso_lotes_productos",(()=>{const e="proceso_lotes_productos",t=a([]),o=a({}),l=r((()=>t.value)),s=r((()=>t.value.length>0)),d=(e,o)=>t.value.findIndex((t=>t.Unidad===o&&t.Producto_Id===e))>-1;return{keyModel:e,storeModel:o,storeData:t,getData:l,getColumns:[{Key:"Producto_Nombre",Text:"Producto",Width:10,Align:"left",FormatMoney:!1},{Key:"UnidadText",Text:"Unidad",Width:10,Align:"left",FormatMoney:!1},{Key:"Cantidad",Text:"Cantidad",Width:10,Align:"right",FormatMoney:!1},{Key:"Precio",Text:"Precio",Width:10,Align:"right",FormatMoney:!1}],isValidFormModel:s,saveData:async o=>{try{if(!s.value)return null;let r=(a=o,t.value.filter((e=>(null==e?void 0:e.Id)>0)).map((e=>({id:e.Id,Unidad:e.Unidad,UnidadText:e.UnidadText,Factor:e.Factor,Cantidad:e.Cantidad,Precio:e.Precio,ProcesoLotes:a,Producto:e.Producto_Id})))),l=null;return r.length>0&&(l=await I.put(`${e}/`,r)),r=(e=>t.value.filter((e=>0===(null==e?void 0:e.Id))).map((t=>({id:0,Unidad:t.Unidad,UnidadText:t.UnidadText,Factor:t.Factor,Cantidad:t.Cantidad,Precio:t.Precio,ProcesoLotes:e,Producto:t.Producto_Id}))))(o),r.length>0&&(l=await I.post(`${e}/`,r)),null==l?void 0:l.data}catch(r){return console.error(r),null}var a},ExistProductoUnidad:d,addList:e=>{try{if(d(e.Producto_Id,e.Unidad))return!1;const o=t.value.findIndex((t=>t===e));return-1===o?t.value.push(e):t.value[o]=e,!0}catch(o){return!1}},deleteData:async o=>{try{let a=t.value.findIndex((e=>e===o));return a>-1&&o.Id>0&&await I.delete(`${e}/${o.Id}/`),a=t.value.findIndex((e=>e.Producto_Id===o.Producto_Id&&e.Unidad===o.Unidad)),a>-1&&t.value.splice(a,1),!0}catch(a){return console.error(a),!1}},get_productos_lotes_by_proceso_lote_id:async e=>{try{const{data:o}=await I.get("get_productos_lotes_by_proceso_lote_id",{params:{procesoLoteId:e}});return t.value=o,o}catch(o){return console.error(o),null}},clearModel:()=>{o.value={},t.value=[]}}})),T={class:"row-span-2"},k={class:"text-2xl font-semibold text-black uppercase"},L={class:"text-gray-500"},O={class:"h-[100%] w-full flex flex-col"},V={class:"row-span-1"},B=["onClick"],$={class:"bg-white row-span-10 overflow-y-auto h-full w-full"},j={class:"w-full flex justify-between"},K={class:"form-container mt-3 w-full"},W=c("label",{for:"txtProceso",class:"form-label"},"Proceso:",-1),A=["value"],q={class:"form-container mt-3 w-full"},S=c("label",{for:"txtProceso",class:"form-label"},"Orden de Compra:",-1),z=["value"],R={class:"form-container mt-3 h-full"},G=c("label",{for:"txtProceso",class:"form-label"},"Provedor:",-1),H=["value"],J={class:"form-container mt-3 h-full"},Q=c("label",{for:"txtOberservacíon",class:"form-label"},"Oberservacíon:",-1),X=c("input",{type:"submit",class:"hidden"},null,-1),Y={class:"rounded-xl overflow-auto h-full bg-white row-span-4"},Z=["onUpdate:modelValue"],ee=["onUpdate:modelValue"],te=l({setup(o){const r=F(),l=E(),I=D(),te=C(),oe=U(),ae=N(),re=a(!1),le=a(!1),se=M(),de=a(0),ne=["Proforma","Productos Cargados"],ie=a({});s((()=>{r.filterData("")}));const ce=e=>{r.filterData(e)},ue=e=>{r.setPageIndex(e)},pe=async()=>{r.clearModel(),ie.value={},l.clearModel(),await I.setData(),await ae.setData(),se.setFocusInput("txtNombre")},me=async({Id:e,Proceso_Id:t,Lote_Id:o,Nota_Id:a,Proveedor_Id:s})=>{if(!e)return void(re.value=!1);await I.setData(),await ae.setData(),await te.filterData(""),re.value=!0,ie.value={},r.clearModel(),l.clearModel(),r.storeModel.id=e,r.storeModel.Proceso=t,r.storeModel.Lote=o,r.storeModel.Nota=a,r.storeModel.Proveedor=s,ie.value=te.getData.find((e=>e.Id===a));await l.get_productos_lotes_by_proceso_lote_id(r.storeModel.id)||w({title:"No tiene productos!",description:"No se pudieron cargar los productos en la lista!"},{type:"danger",hideProgressBar:!0,position:"bottom-right"}),de.value=0,se.setFocusInput("txtNombre")},ve=async()=>{if(!r.isValidFormModel)return void w({title:"Error",description:"El formulario es incorrecto!"},{type:"danger",position:"bottom-right",hideProgressBar:!0});if(!l.isValidFormModel)return void w({title:"Error",description:"No se cargaron los productos!"},{type:"danger",position:"bottom-right",hideProgressBar:!0});le.value=!0;const e=await r.saveData();if(!e)return void w({title:"Error",description:"Ocurrio un problema, no se completó el registo!"},{type:"danger",position:"bottom-right",hideProgressBar:!0});await l.saveData(e.id)?(r.filterData(""),re.value=le.value=!1,w({title:"Exitoso",description:"El registro se completó correctamente!"},{type:"success",position:"bottom-right",hideProgressBar:!0})):w({title:"Error",description:"Ocurrio un problema, no se completó el registo de los productos!"},{type:"danger",position:"bottom-right",hideProgressBar:!0})},ge=e=>{re.value=e},fe=async()=>{if(ie.value.IsAceptado&&!r.storeModel.id)return w({title:"Error",description:"La nota ya fue aceptada!"},{type:"danger",position:"bottom-right",hideProgressBar:!0}),ie.value={},void oe.clearModel();oe.clearModel(),r.storeModel.Nota=ie.value.Id,r.storeModel.Lote=ie.value.Lote_Id;const e=await oe.get_nota_detalles_by_nota_id(r.storeModel.Nota);e?(l.clearModel(),e.forEach((e=>{l.storeData.push({Id:0,Unidad:e.Unidad_Id,UnidadText:e.Unidad_Nombre,Factor:e.Factor,Cantidad:e.Cantidad,Precio:0,ProcesoLotes:0,Producto_Id:e.Producto_Id,Producto_Nombre:e.Producto_Nombre})})),w({title:"Exitoso",description:`Se cargaron ${e.length} productos correctamente`},{type:"success",position:"bottom-right",hideProgressBar:!0})):w({title:"Error",description:"No se encontraron notas"},{type:"danger",position:"bottom-right",hideProgressBar:!0})},he=e=>{l.deleteData(e)};return(o,a)=>{const s=e,w=t;return d(),n(w,{columns:m(r).getColumns,data:m(r).getData||[],count:m(r).getCounts,titulo:"Contratos",subtitulo:"Lista de Contratos con Proveedores","page-index":m(r).getPageIndex,"show-modal":re.value,"modal-width":"50rem","modal-height":"50rem","show-loading":le.value,onAddEvent:pe,onUpdateEvent:me,onFilterEvent:ce,onPageIndex:ue,onNext:a[7]||(a[7]=e=>m(r).setNext()),onPrevius:a[8]||(a[8]=e=>m(r).setPrevius()),onModalIsOpen:ge},{cabecera:i((()=>[c("div",T,[c("h1",k,[u(p(m(r).storeModel.id?"Editar":"Nuevo")+" "+p("Enlace de ODC a Proveedor")+" ",1),c("b",L,p(m(r).storeModel.id),1)])])])),cuerpo:i((()=>[c("div",O,[c("section",V,[(d(),v(f,null,g(ne,((e,t)=>c("button",{key:t,class:h(["text-gray-600 focus:outline-none font-medium rounded-lg p-2 text-xs",{"border-green-500 border-b-2 shadow-lg transition  duration-300 ease-in-out transform hover:-translate-y-1 hover:scale-100":de.value===t," rounded-none rounded-r-lg":0==t}]),onClick:e=>de.value=t},p(e),11,B))),64))]),c("section",$,[c("form",{class:h(["form-container w-full h-full p-3",0==de.value?"grid":"hidden"]),onSubmit:a[6]||(a[6]=b((()=>{}),["prevent"]))},[c("div",j,[c("div",K,[W,x(c("select",{id:"proceso","onUpdate:modelValue":a[0]||(a[0]=e=>m(r).storeModel.Proceso=e),class:"form-input w-full focus:text-black bg-green-500 text-white",required:"",onChange:a[1]||(a[1]=e=>m(te).filterData(""))},[(d(!0),v(f,null,g(m(I).getData,((e,t)=>(d(),v("option",{key:t,value:e.id,class:"text-gray-700"},p(e.Nombre),9,A)))),128))],544),[[P,m(r).storeModel.Proceso]])]),c("div",q,[S,x(c("select",{id:"proceso","onUpdate:modelValue":a[2]||(a[2]=e=>ie.value=e),class:"form-input w-full focus:text-black bg-green-500 text-white",required:"",onChange:fe},[(d(!0),v(f,null,g(m(te).getData,((e,t)=>(d(),v("option",{key:t,value:e,class:"text-gray-700"},p(e.Serie),9,z)))),128))],544),[[P,ie.value]])])]),c("div",R,[G,x(c("select",{id:"proceso","onUpdate:modelValue":a[3]||(a[3]=e=>m(r).storeModel.Proveedor=e),class:"form-input w-full focus:text-black lg:w-[50%] bg-green-500 text-white",required:"",onInput:a[4]||(a[4]=e=>m(se).setFocusInput("txtNombre"))},[(d(!0),v(f,null,g(m(ae).getData,((e,t)=>(d(),v("option",{key:t,value:e.id,class:"text-gray-700"},p(e.RazonSocial),9,H)))),128))],544),[[P,m(r).storeModel.Proveedor]])]),c("div",J,[Q,x(c("textarea",{id:"txtOberservacíon","onUpdate:modelValue":a[5]||(a[5]=e=>m(r).storeModel.Observacion=e),class:"form-input sm:w-full lg:w-[100%]",placeholder:"Oberservacíon",required:""},null,512),[[y,m(r).storeModel.Observacion]])]),X],34),c("section",{class:h(["form-container h-full p-3 grid grid-rows-5",1==de.value?"flex":"hidden"])},[c("section",Y,[_(s,{columns:m(l).getColumns,data:m(l).storeData,actions:!0,class:"row-span-5 h-full","link-id":!1,onDeleteRow:he},{Cantidad:i((({index:e})=>[x(c("input",{"onUpdate:modelValue":t=>m(l).storeData[e].Cantidad=t,type:"number",class:"form-input text-center w-24"},null,8,Z),[[y,m(l).storeData[e].Cantidad]])])),Precio:i((({index:e})=>[x(c("input",{"onUpdate:modelValue":t=>m(l).storeData[e].Precio=t,type:"number",class:"form-input text-center w-24"},null,8,ee),[[y,m(l).storeData[e].Precio]])])),_:1},8,["columns","data"])])],2)])])])),acciones:i((()=>[c("div",{class:"flex items-center px-5"},[c("button",{class:"btn-submit text-white font-bold py-2 px-4 rounded-lg",onClick:ve}," Guardar ")])])),_:1},8,["columns","data","count","page-index","show-modal","show-loading"])}}});export{te as default};
