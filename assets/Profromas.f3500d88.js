import{a as e,_ as o,b as t}from"./DataTableComponent.cb6a3736.js";import{_ as a}from"./InputSearch.2d646a14.js";import{_ as r}from"./auto-download.5d8456a1.js";import{g as l,r as s,k as i,o as d,d as n,p as u,x as c,i as p,h as m,t as g,y as v,j as f,F as b,l as h,n as w,B as y,z as x,I as P,A as _,s as M}from"./vendor.596c221c.js";/* empty css              */import{u as k,a as C}from"./notasDetalles.821ccbd0.js";import{u as I}from"./proceso.f9f9c644.js";import{u as D}from"./producto.b2d23570.js";import{u as F}from"./utils.062368f7.js";import{u as B}from"./lote.6dc672b2.js";import"./app.649779bd.js";const L=m("svg",{id:"Capa_1",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",x:"0px",y:"0px",width:"170",viewBox:"0 0 464.98 464.98",style:{"enable-background":"new 0 0 464.98 464.98"},"xml:space":"preserve"},[m("g",{id:"XMLID_4_"},[m("g",null,[m("polygon",{style:{fill:"#3A75AA"},points:"415.795,273.63 415.795,334.14 389.855,307.64 389.855,247.13"}),m("polygon",{style:{fill:"#3A75AA"},points:"156.745,9 188.975,41.93 87.355,41.93 87.355,73.37 49.185,73.37 49.185,9"}),m("polygon",{style:{fill:"#4489D3"},points:"415.795,436.01 415.795,455.98 49.185,455.98 49.185,82.37 156.735,82.37 415.795,347"}),m("polygon",{style:{fill:"#FFCC73"},points:"380.855,50.93 380.855,298.44 292.465,208.16 343.435,208.16 343.435,199.16\r\n283.655,199.16 248.005,162.73 343.435,162.73 343.435,153.73 239.185,153.73 203.545,117.32 343.435,117.32 343.435,108.32\r\n194.735,108.32 160.525,73.37 96.355,73.37 96.355,50.93"}),m("path",{d:"M424.795,343.34v121.64H40.185V0h120.34l41.05,41.93h188.28v192.33l34.94,35.7v73.37V343.34z M415.795,455.98v-19.97V347\r\nL156.735,82.37H49.185v373.61H415.795z M415.795,334.14v-60.51l-25.94-26.5v60.51L415.795,334.14z M380.855,298.44V50.93h-284.5\r\nv22.44h64.17l34.21,34.95h148.7v9h-139.89l35.64,36.41h104.25v9h-95.43l35.65,36.43h59.78v9h-50.97L380.855,298.44z\r\n M188.975,41.93L156.745,9H49.185v64.37h38.17V41.93H188.975z"})])]),m("g"),m("g"),m("g"),m("g"),m("g"),m("g"),m("g"),m("g"),m("g"),m("g"),m("g"),m("g"),m("g"),m("g"),m("g")],-1),N={class:"row-span-2"},V={class:"text-2xl font-semibold text-black uppercase"},U={class:"text-gray-500"},A={key:0,class:"text-xs text-red-500"},S={class:"h-[100%] w-full flex flex-col overflow-y-auto"},j={class:"row-span-1"},E=["onClick"],O={class:"bg-white row-span-10 overflow-y-auto h-full w-full"},z={class:"form-container"},H=m("label",{for:"proceso",class:"form-label"},"Proceso",-1),q={key:0},G=["value"],R={key:1,class:"w-full flex flex-col"},T={class:"form-input w-full focus:text-black lg:w-[50%] bg-green-500 text-white"},K={class:"form-container"},X=m("label",{for:"observaciones",class:"form-label"},"Observaciones",-1),J=["disabled"],Q=m("input",{type:"submit",class:"hidden"},null,-1),W={class:"flex w-full text-left justify-between bg-gray-200 rounded-lg"},Y={class:"form-container w-full"},Z=m("label",{for:"lote",class:"form-label"},"Elegir un Lote para los productos",-1),$={key:0},ee=["value"],oe={key:1,class:"w-full flex flex-col"},te={class:"form-input w-full focus:text-black lg:w-[50%] bg-green-500 text-white"},ae={class:"text-left w-full flex items-center"},re={class:"form-container"},le=m("label",{for:"lotenuevo",class:"form-label"},"ó Crear Nuevo Lote",-1),se={class:"relative flex w-full items-center row-span-1"},ie={class:"form-container"},de=m("label",{for:"cantidad",class:"form-label"},"Cantidad",-1),ne=v("Agregar "),ue={class:"rounded-xl overflow-auto bg-white row-span-4"},ce=["onUpdate:modelValue"],pe={key:1,class:"bg-gray-200 p-2 rounded-lg text-gray-300",disabled:""},me=l({setup(l){const me=k(),ge=C(),ve=I(),fe=D(),be=F(),he=B(),we=s(!1),ye=s({}),xe=s({}),Pe=s(!1),_e=s(0),Me=s(!1),ke=s(""),Ce=s(0),Ie=["Lista de Productos","Proforma"],De=s(!1);i((()=>{me.filterData("")}));const Fe=e=>{me.filterData(e)},Be=async()=>{xe.value={},me.clearModel(),ge.clearModel();const e=await ve.setProcesoActivo();if(!e)return M({title:"No tienes procesos disponibles",description:"Habra un proceso por favor! 👍😊"},{type:"info",hideProgressBar:!0,position:"bottom-right"}),void(we.value=!1);xe.value=e,he.filterData(""),await fe.get_productos_for_notas_compras(""),me.storeModel.Proceso=e.id,Ce.value=0,be.setFocusInput("inputSearch")},Le=async({Id:e,Proceso_Id:o,Proceso_Nombre:t,Serie:a,Fecha:r,Observaciones:l,Lote_Id:s,Lote_Nombre:i})=>{if(!e)return void(we.value=!1);De.value=!0;const d=await ve.setProcesoActivo();(null==d?void 0:d.id)!==o&&(Pe.value=!0),we.value=!0,xe.value={},me.clearModel(),ge.clearModel(),await he.filterData(""),xe.value.id=o,xe.value.Nombre=t,me.storeModel.id=e,me.storeModel.Proceso=o,me.storeModel.Serie=a,me.storeModel.Fecha=r,me.storeModel.Observaciones=l,me.storeModel.Lote=s;ge.get_nota_detalles_by_nota_id(e)||M({title:"Ocurrio un problema",description:"El pedido no tiene ningun producto!"},{type:"danger",hideProgressBar:!0,position:"bottom-right"}),Ce.value=0,be.setFocusInput("inputSearch"),De.value=!1},Ne=()=>me.isValidFormModel?ge.isValidFormModel?void(Me.value=!0):(M({title:"Formulario incompleto",description:"Por favor ingrese los productos al pedido"},{type:"info",hideProgressBar:!0,position:"bottom-right"}),void(Me.value=!1)):(M({title:"Formulario incompleto",description:"Por favor completa todos los campos"},{type:"info",hideProgressBar:!0,position:"bottom-right"}),void(Me.value=!1)),Ve=async()=>{if(De.value=!0,!me.isValidFormModel)return void M({title:"Formulario incompleto",description:"Por favor completa todos los campos"},{type:"info",hideProgressBar:!0,position:"bottom-right"});if(!ge.isValidFormModel)return void M({title:"Formulario incompleto",description:"Por favor ingrese los productos al pedido"},{type:"info",hideProgressBar:!0,position:"bottom-right"});const e=await me.saveData();if(!e)return void M({title:"Error al guardar",description:"Por favor intenta nuevamente"},{type:"danger",hideProgressBar:!0,position:"bottom-right"});await ge.saveData(e.id)?(M({title:"Guardado",description:"Pedido guardado correctamente"},{type:"success",hideProgressBar:!0,position:"bottom-right"}),De.value=we.value=Me.value=!1,me.filterData("")):M({title:"Error al guardar",description:"No se pudieron guardar los productos del pedido"},{type:"danger",hideProgressBar:!0,position:"bottom-right"})},Ue=e=>{we.value=e},Ae=async e=>{await fe.get_productos_for_notas_compras(e)},Se=e=>{ye.value=e,setTimeout((()=>{be.setFocusInput("cantidad")}),100)},je=async()=>{if(!ye.value.Id)return void M({title:"Seleccione un producto",description:"Por favor!"},{type:"info",hideProgressBar:!0,position:"bottom-right"});if(!_e.value)return void M({title:"Ingrese la cantidad",description:"Por favor!"},{type:"info",hideProgressBar:!0,position:"bottom-right"});const e={Id:0,Nota:0,Producto_Id:ye.value.Id,Producto_Nombre:ye.value.Producto_Nombre,Unidad_Id:ye.value.Unidad_Id,Unidad_Nombre:ye.value.Unidad_Nombre,Factor:ye.value.Factor,Cantidad:_e.value};if(ge.ExistProductoUnidad(e.Producto_Id,e.Unidad_Id))return M({title:"El producto ya está en la lista!"},{type:"info",hideProgressBar:!0,position:"bottom-right"}),ye.value={},_e.value=0,void be.setFocusInput("inputSearch");ge.addList(e)?(ye.value={},_e.value=0,be.setFocusButton("inputSearch")):M({title:"No se pudo agregar el producto"},{type:"info",hideProgressBar:!0,position:"bottom-right"})},Ee=e=>{"Enter"===e.key&&je()},Oe=e=>{ge.deleteData(e)},ze=async()=>{var e;if(he.storeModel.id=0,he.storeModel.Nombre=ke.value,!he.isValidFormModel)return void M({title:"Error",description:"Ingrese el nombre del lote"},{type:"danger",hideProgressBar:!0,position:"bottom-right"});const o=await he.saveData();o?(M({title:"Exitoso",description:"Lote guardado correctamente!"},{type:"success",hideProgressBar:!0,position:"bottom-right"}),await he.setData(),me.storeModel.Lote=(null==(e=he.getData.find((e=>e.id===o.id)))?void 0:e.id)||0):M({title:"No se pudo guardar el lote"},{type:"danger",hideProgressBar:!0,position:"bottom-right"})};return(l,s)=>{const i=e,M=a,k=r,C=o,I=t;return d(),n(b,null,[u(C,{columns:p(me).getColumns,data:p(me).getData||[],count:p(me).getCounts,titulo:"Proformas",subtitulo:"Lista de Proformas","page-index":p(me).getPageIndex,"show-modal":we.value,"modal-width":"50rem","modal-height":"50rem","show-loading":De.value,onAddEvent:Be,onUpdateEvent:Le,onFilterEvent:Fe,onModalIsOpen:Ue},{imagen:c((()=>[L])),table:c((()=>[u(i,{columns:p(me).getColumns,data:p(me).getData||[],"link-id":!0,onClickRow:Le},{IsAceptado:c((({item:e})=>[m("span",null,g(e?"Aceptado":"Sin Aceptar"),1)])),_:1},8,["columns","data"])])),cabecera:c((()=>[m("div",N,[m("h1",V,[v(g(p(me).storeModel.id?"Editar":"Nueva")+" "+g("Orden de Compra")+" ",1),m("b",U,g(p(me).storeModel.id),1)]),Pe.value?(d(),n("div",A," Registro de solo lectura ")):f("",!0)])])),cuerpo:c((()=>[m("div",S,[m("section",j,[(d(),n(b,null,h(Ie,((e,o)=>m("button",{key:o,class:w(["text-gray-600 focus:outline-none font-medium rounded-lg p-2 text-xs",{"border-green-500 border-b-2 shadow-lg transition  duration-300 ease-in-out transform hover:-translate-y-1 hover:scale-100":Ce.value===o," rounded-none rounded-r-lg":0==o}]),onClick:e=>Ce.value=o},g(e),11,E))),64))]),m("section",O,[m("form",{class:w(["form-container w-full h-full p-3",1==Ce.value?"grid":"hidden"]),onSubmit:s[2]||(s[2]=y((()=>{}),["prevent"]))},[m("div",z,[H,Pe.value?(d(),n("div",R,[m("span",T,g(xe.value.Nombre),1)])):(d(),n("div",q,[x(m("select",{id:"proceso","onUpdate:modelValue":s[0]||(s[0]=e=>p(me).storeModel.Proceso=e),class:"form-input w-full focus:text-black lg:w-[50%] bg-green-500 text-white",required:""},[(d(!0),n(b,null,h([xe.value],((e,o)=>(d(),n("option",{key:o,value:e.id,class:"text-gray-70 0","aria-readonly":"true"},g(e.Nombre),9,G)))),128))],512),[[P,p(me).storeModel.Proceso]])]))]),m("div",K,[X,x(m("textarea",{id:"observaciones","onUpdate:modelValue":s[1]||(s[1]=e=>p(me).storeModel.Observaciones=e),class:"form-input w-full focus:text-black bg-white text-gray-500",disabled:Pe.value},null,8,J),[[_,p(me).storeModel.Observaciones]])]),Q],34),m("section",{class:w(["form-container h-full p-3 grid grid-rows-5",0==Ce.value?"flex":"hidden"])},[m("div",W,[m("div",Y,[Z,Pe.value?(d(),n("div",oe,[m("span",te,g(xe.value.Nombre),1)])):(d(),n("div",$,[x(m("select",{id:"lote","onUpdate:modelValue":s[3]||(s[3]=e=>p(me).storeModel.Lote=e),class:"form-input w-full focus:text-black bg-green-500 text-white",required:""},[(d(!0),n(b,null,h(p(he).getData,((e,o)=>(d(),n("option",{key:o,value:e.id,class:"text-gray -700","aria-readonly":"true"},g(e.Nombre),9,ee)))),128))],512),[[P,p(me).storeModel.Lote]])]))]),m("div",ae,[m("div",re,[le,x(m("input",{id:"lotenuevo","onUpdate:modelValue":s[4]||(s[4]=e=>ke.value=e),class:"form-input w-full focus:text-black bg-white text-gray-500"},null,512),[[_,ke.value]])]),m("button",{class:"btn-primary w-24 text-xs",onClick:ze}," Guardar Lote ")])]),m("div",se,[u(M,{field:ye.value,"place-holder":"Buscar el producto",class:"w-[50%]",data:p(fe).getProductosProcesoLote,"column-label":"Producto_Nombre_Unidad",onSelected:Se,onSearch:Ae},null,8,["field","data"]),m("div",ie,[de,x(m("input",{id:"cantidad","onUpdate:modelValue":s[5]||(s[5]=e=>_e.value=e),class:"form-input w-full focus:text-black bg-white text-gray-500",type:"number",min:"0",step:"1",onKeydown:Ee},null,544),[[_,_e.value]])]),m("div",null,[m("button",{class:"btn-submit bg-white border border-blue-500 text-blue-500 text-xs flex gap-2",onClick:je},[u(k),ne])])]),m("section",ue,[u(i,{columns:p(ge).getColumns,data:p(ge).storeData,actions:!0,class:"row-span-4","link-id":!1,onDeleteRow:Oe},{Cantidad:c((({index:e})=>[x(m("input",{"onUpdate:modelValue":o=>p(ge).storeData[e].Cantidad=o,type:"number",class:"form-input text-center w-24"},null,8,ce),[[_,p(ge).storeData[e].Cantidad]])])),_:1},8,["columns","data"])])],2)])])])),acciones:c((()=>[Pe.value?(d(),n("button",pe," Solo Lectura ")):(d(),n("button",{key:0,class:"btn-submit text-white font-bold py-2 px-4 rounded-lg",onClick:Ne}," Guardar "))])),_:1},8,["columns","data","count","page-index","show-modal","show-loading"]),u(I,{"show-modal":Me.value,"modal-width":"20rem","modal-height":"10rem",description:"Seguro que desea guardar los datos?",onConfirm:Ve,onCancel:s[6]||(s[6]=e=>Me.value=!1)},null,8,["show-modal"])],64)}}});export{me as default};
