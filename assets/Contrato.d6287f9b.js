import{_ as e,b as t}from"./DataTableComponent.a9d13bd4.js";import{e as o,r as a,f as r,g as l,l as s,o as n,w as d,x as i,i as c,h as u,y as p,t as g,d as m,m as v,n as f,F as h,B as x,z as y,K as b,A as P,q as w}from"./vendor.a51b8ffa.js";import{t as _}from"./style.7d124276.js";import{i as M}from"./app.1c80cf5c.js";import{u as I}from"./utils.08d0e0c0.js";import{u as C}from"./proceso.a128cdb5.js";import{u as D,a as U}from"./notasDetalles.860ec3f4.js";import{u as N}from"./proveedor.82f9f9b4.js";const F=o("proceso_lotes",(()=>{const e="proceso_lotes",t=a({}),o=a({}),l=a([{}]),s=a(1),n=r((()=>l.value)),d=r((()=>l.value.length)),i=r((()=>s.value)),c=r((()=>{const{Proceso:e}=t.value;return e>0})),u=async()=>{try{const t=1===s.value||0===s.value?{}:{page:s.value},{data:a}=await M.get(e,{params:t});return o.value=a,a}catch(t){return console.error(t),null}},p=async e=>{if(e)try{const{data:t}=await M.get("filter_proceso_lotes",{params:{text:e}});return l.value=t,t}catch(t){return console.error(t),null}else p(" ")},g=e=>{s.value=e,u()};return{keyModel:e,storeModel:t,getData:n,getCounts:d,getColumns:[{Key:"Id",Text:"Id",Width:10},{Key:"Proceso_Nombre",Text:"Proceso",Width:90},{Key:"Nota_Nombre",Text:"ODC",Width:90},{Key:"Lote_Nombre",Text:"Lote",Width:60},{Key:"Proveedor_Nombre",Text:"Proveedor",Width:60}],getPageIndex:i,isValidFormModel:c,setData:u,saveData:async()=>{try{if(!c.value)return null;let o=null;return o=t.value.id?await M.put(`${e}/${t.value.id}/`,t.value):await M.post(`${e}/`,t.value),u(),o.data}catch(o){return console.error(o),null}},filterData:p,setById:async t=>{try{const{data:o}=await M.get(`${e}/${t}/`);return o}catch(o){return console.error(o),null}},setPageIndex:g,setPrevius:()=>{s.value>1&&g(s.value-1)},setNext:()=>{const e=Math.abs(Math.ceil(d.value/I().CountPagination));s.value<e&&g(s.value+1)},clearModel:()=>{t.value={}}}})),E=o("proceso_lotes_productos",(()=>{const e="proceso_lotes_productos",t=a([]),o=a({}),l=r((()=>t.value)),s=r((()=>t.value.length>0)),n=(e,o)=>t.value.findIndex((t=>t.Unidad===o&&t.Producto_Id===e))>-1;return{keyModel:e,storeModel:o,storeData:t,getData:l,getColumns:[{Key:"Producto_Nombre",Text:"Producto",Width:10,Align:"left",FormatMoney:!1},{Key:"UnidadText",Text:"Unidad",Width:10,Align:"left",FormatMoney:!1},{Key:"Cantidad",Text:"Cantidad",Width:10,Align:"right",FormatMoney:!1},{Key:"Precio",Text:"Precio",Width:10,Align:"right",FormatMoney:!1}],isValidFormModel:s,saveData:async o=>{try{if(!s.value)return null;let r=(a=o,t.value.filter((e=>(null==e?void 0:e.Id)>0)).map((e=>({id:e.Id,Unidad:e.Unidad,UnidadText:e.UnidadText,Factor:e.Factor,Cantidad:e.Cantidad,Precio:e.Precio,ProcesoLotes:a,Producto:e.Producto_Id})))),l=null;return r.length>0&&(l=await M.put(`${e}/`,r)),r=(e=>t.value.filter((e=>0===(null==e?void 0:e.Id))).map((t=>({id:0,Unidad:t.Unidad,UnidadText:t.UnidadText,Factor:t.Factor,Cantidad:t.Cantidad,Precio:t.Precio,ProcesoLotes:e,Producto:t.Producto_Id}))))(o),r.length>0&&(l=await M.post(`${e}/`,r)),null==l?void 0:l.data}catch(r){return console.error(r),null}var a},ExistProductoUnidad:n,addList:e=>{try{if(n(e.Producto_Id,e.Unidad))return!1;const o=t.value.findIndex((t=>t===e));return-1===o?t.value.push(e):t.value[o]=e,!0}catch(o){return!1}},deleteData:async o=>{try{let a=t.value.findIndex((e=>e===o));return a>-1&&o.Id>0&&await M.delete(`${e}/${o.Id}/`),a=t.value.findIndex((e=>e.Producto_Id===o.Producto_Id&&e.Unidad===o.Unidad)),a>-1&&t.value.splice(a,1),!0}catch(a){return console.error(a),!1}},get_productos_lotes_by_proceso_lote_id:async e=>{try{const{data:o}=await M.get("get_productos_lotes_by_proceso_lote_id",{params:{procesoLoteId:e}});return t.value=o,o}catch(o){return console.error(o),null}},clearModel:()=>{o.value={},t.value=[]}}})),k=u("svg",{id:"Capa_1",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",x:"0px",y:"0px",width:"170",viewBox:"0 0 512 512",style:{"enable-background":"new 0 0 512 512"},"xml:space":"preserve"},[u("g",null,[u("g",null,[u("path",{style:{fill:"#FFE0B1"},d:"M496,48H16C7.18,48,0,55.18,0,64v384c0,8.82,7.18,16,16,16h480c8.82,0,16-7.18,16-16V64\r\nC512,55.18,504.82,48,496,48z"})]),u("g",null,[u("g",null,[u("path",{style:{fill:"#5C546A"},d:"M400,416h-56c-4.422,0-8-3.578-8-8s3.578-8,8-8h56c4.422,0,8,3.578,8,8S404.422,416,400,416z"})])]),u("g",null,[u("g",null,[u("path",{style:{fill:"#8A8895"},d:"M448,416h-16c-4.422,0-8-3.578-8-8s3.578-8,8-8h16c4.422,0,8,3.578,8,8S452.422,416,448,416z"})])]),u("g",null,[u("g",null,[u("path",{style:{fill:"#5C546A"},d:"M448,352H344c-4.422,0-8-3.578-8-8s3.578-8,8-8h104c4.422,0,8,3.578,8,8S452.422,352,448,352z"})])]),u("g",null,[u("g",null,[u("path",{style:{fill:"#5C546A"},d:"M376,384h-32c-4.422,0-8-3.578-8-8s3.578-8,8-8h32c4.422,0,8,3.578,8,8S380.422,384,376,384z"})])]),u("g",null,[u("g",null,[u("path",{style:{fill:"#8A8895"},d:"M416,384h-8c-4.422,0-8-3.578-8-8s3.578-8,8-8h8c4.422,0,8,3.578,8,8S420.422,384,416,384z"})])]),u("g",null,[u("circle",{style:{fill:"#FF4F19"},cx:"360",cy:"288",r:"24"})]),u("g",null,[u("path",{style:{fill:"#9E6459"},d:"M184,48v192c0,2.773,1.438,5.344,3.797,6.805c2.359,1.469,5.297,1.578,7.781,0.352L256,216.945\r\nl60.422,30.211c1.133,0.563,2.352,0.844,3.578,0.844c1.461,0,2.922-0.398,4.203-1.195c2.359-1.461,3.797-4.031,3.797-6.805V48H184\r\nz"})])]),u("g"),u("g"),u("g"),u("g"),u("g"),u("g"),u("g"),u("g"),u("g"),u("g"),u("g"),u("g"),u("g"),u("g"),u("g")],-1),T={class:"row-span-2"},V={class:"text-2xl font-semibold text-black uppercase"},L={class:"text-gray-500"},B={class:"h-[100%] w-full flex flex-col"},O={class:"row-span-1"},A=["onClick"],K={class:"bg-white row-span-10 overflow-y-auto h-full w-full"},$={class:"w-full flex justify-between"},j={class:"form-container mt-3 w-full"},z=u("label",{for:"txtProceso",class:"form-label"},"Proceso:",-1),S=["value"],W={class:"form-container mt-3 w-full"},q=u("label",{for:"txtProceso",class:"form-label"},"Orden de Compra:",-1),H=["value"],R={class:"form-container mt-3 h-full"},G=u("label",{for:"txtProceso",class:"form-label"},"Provedor:",-1),J=["value"],Q={class:"form-container mt-3 h-full"},X=u("label",{for:"txtOberservacíon",class:"form-label"},"Oberservacíon:",-1),Y=u("input",{type:"submit",class:"hidden"},null,-1),Z={class:"rounded-xl overflow-auto bg-white row-span-4"},ee=["onUpdate:modelValue"],te=["onUpdate:modelValue"],oe=l({setup(o){const r=F(),l=E(),M=C(),oe=D(),ae=U(),re=N(),le=a(!1),se=a(!1),ne=I(),de=a(0),ie=["Proforma","Productos Cargados"],ce=a({});s((()=>{r.filterData("")}));const ue=e=>{r.filterData(e)},pe=e=>{r.setPageIndex(e)},ge=async()=>{r.clearModel(),ce.value={},l.clearModel(),await M.setData(),await re.setData(),ne.setFocusInput("txtNombre")},me=async({Id:e,Proceso_Id:t,Lote_Id:o,Nota_Id:a,Proveedor_Id:s})=>{if(!e)return void(le.value=!1);await M.setData(),await re.setData(),await oe.filterData(""),le.value=!0,ce.value={},r.clearModel(),l.clearModel(),r.storeModel.id=e,r.storeModel.Proceso=t,r.storeModel.Lote=o,r.storeModel.Nota=a,r.storeModel.Proveedor=s,ce.value=oe.getData.find((e=>e.Id===a));await l.get_productos_lotes_by_proceso_lote_id(r.storeModel.id)||_({title:"No tiene productos!",description:"No se pudieron cargar los productos en la lista!"},{type:"danger",hideProgressBar:!0,position:"bottom-right"}),de.value=0,ne.setFocusInput("txtNombre")},ve=async()=>{if(!r.isValidFormModel)return void _({title:"Error",description:"El formulario es incorrecto!"},{type:"danger",position:"bottom-right",hideProgressBar:!0});if(!l.isValidFormModel)return void _({title:"Error",description:"No se cargaron los productos!"},{type:"danger",position:"bottom-right",hideProgressBar:!0});se.value=!0;const e=await r.saveData();if(!e)return void _({title:"Error",description:"Ocurrio un problema, no se completó el registo!"},{type:"danger",position:"bottom-right",hideProgressBar:!0});await l.saveData(e.id)?(r.filterData(""),le.value=se.value=!1,_({title:"Exitoso",description:"El registro se completó correctamente!"},{type:"success",position:"bottom-right",hideProgressBar:!0})):_({title:"Error",description:"Ocurrio un problema, no se completó el registo de los productos!"},{type:"danger",position:"bottom-right",hideProgressBar:!0})},fe=e=>{le.value=e},he=async()=>{ae.clearModel(),r.storeModel.Nota=ce.value.Id,r.storeModel.Lote=ce.value.Lote_Id;const e=await ae.get_nota_detalles_by_nota_id(r.storeModel.Nota);e?(l.clearModel(),e.forEach((e=>{l.storeData.push({Id:0,Unidad:e.Unidad_Id,UnidadText:e.Unidad_Nombre,Factor:e.Factor,Cantidad:e.Cantidad,Precio:0,ProcesoLotes:0,Producto_Id:e.Producto_Id,Producto_Nombre:e.Producto_Nombre})})),_({title:"Exitoso",description:`Se cargaron ${e.length} productos correctamente`},{type:"success",position:"bottom-right",hideProgressBar:!0})):_({title:"Error",description:"No se encontraron notas"},{type:"danger",position:"bottom-right",hideProgressBar:!0})},xe=e=>{l.deleteData(e)};return(o,a)=>{const s=t,_=e;return n(),d(_,{columns:c(r).getColumns,data:c(r).getData||[],count:c(r).getCounts,titulo:"Contratos",subtitulo:"Lista de Contratos con Proveedores","page-index":c(r).getPageIndex,"show-modal":le.value,"modal-width":"50rem","modal-height":"40rem","show-loading":se.value,onAddEvent:ge,onUpdateEvent:me,onFilterEvent:ue,onPageIndex:pe,onNext:a[7]||(a[7]=e=>c(r).setNext()),onPrevius:a[8]||(a[8]=e=>c(r).setPrevius()),onModalIsOpen:fe},{imagen:i((()=>[k])),cabecera:i((()=>[u("div",T,[u("h1",V,[p(g(c(r).storeModel.id?"Editar":"Nuevo")+" "+g("Enlace de ODC a Proveedor")+" ",1),u("b",L,g(c(r).storeModel.id),1)])])])),cuerpo:i((()=>[u("div",B,[u("section",O,[(n(),m(h,null,v(ie,((e,t)=>u("button",{key:t,class:f(["text-gray-600 focus:outline-none font-medium rounded-lg p-2 text-xs",{"border-green-500 border-b-2 shadow-lg transition  duration-300 ease-in-out transform hover:-translate-y-1 hover:scale-100":de.value===t," rounded-none rounded-r-lg":0==t}]),onClick:e=>de.value=t},g(e),11,A))),64))]),u("section",K,[u("form",{class:f(["form-container w-full h-full p-3",0==de.value?"grid":"hidden"]),onSubmit:a[6]||(a[6]=x((()=>{}),["prevent"]))},[u("div",$,[u("div",j,[z,y(u("select",{id:"proceso","onUpdate:modelValue":a[0]||(a[0]=e=>c(r).storeModel.Proceso=e),class:"form-input w-full focus:text-black bg-green-500 text-white",required:"",onChange:a[1]||(a[1]=e=>c(oe).filterData(""))},[(n(!0),m(h,null,v(c(M).getData,((e,t)=>(n(),m("option",{key:t,value:e.id,class:"text-gray-700"},g(e.Nombre),9,S)))),128))],544),[[b,c(r).storeModel.Proceso]])]),u("div",W,[q,y(u("select",{id:"proceso","onUpdate:modelValue":a[2]||(a[2]=e=>ce.value=e),class:"form-input w-full focus:text-black bg-green-500 text-white",required:"",onChange:he},[(n(!0),m(h,null,v(c(oe).getData,((e,t)=>(n(),m("option",{key:t,value:e,class:"text-gray-700"},g(e.Serie),9,H)))),128))],544),[[b,ce.value]])])]),u("div",R,[G,y(u("select",{id:"proceso","onUpdate:modelValue":a[3]||(a[3]=e=>c(r).storeModel.Proveedor=e),class:"form-input w-full focus:text-black lg:w-[50%] bg-green-500 text-white",required:"",onInput:a[4]||(a[4]=e=>c(ne).setFocusInput("txtNombre"))},[(n(!0),m(h,null,v(c(re).getData,((e,t)=>(n(),m("option",{key:t,value:e.id,class:"text-gray-700"},g(e.RazonSocial),9,J)))),128))],544),[[b,c(r).storeModel.Proveedor]])]),u("div",Q,[X,y(u("textarea",{id:"txtOberservacíon","onUpdate:modelValue":a[5]||(a[5]=e=>c(r).storeModel.Observacion=e),class:"form-input sm:w-full lg:w-[100%]",placeholder:"Oberservacíon",required:""},null,512),[[P,c(r).storeModel.Observacion]])]),Y],34),u("section",{class:f(["form-container h-full p-3 grid grid-rows-5",1==de.value?"flex":"hidden"])},[u("section",Z,[w(s,{columns:c(l).getColumns,data:c(l).storeData,actions:!0,class:"row-span-4","link-id":!1,onDeleteRow:xe},{Cantidad:i((({index:e})=>[y(u("input",{"onUpdate:modelValue":t=>c(l).storeData[e].Cantidad=t,type:"number",class:"form-input text-center w-24"},null,8,ee),[[P,c(l).storeData[e].Cantidad]])])),Precio:i((({index:e})=>[y(u("input",{"onUpdate:modelValue":t=>c(l).storeData[e].Precio=t,type:"number",class:"form-input text-center w-24"},null,8,te),[[P,c(l).storeData[e].Precio]])])),_:1},8,["columns","data"])])],2)])])])),acciones:i((()=>[u("button",{class:"btn-submit text-white font-bold py-2 px-4 rounded-lg",onClick:ve}," Guardar ")])),_:1},8,["columns","data","count","page-index","show-modal","show-loading"])}}});export{oe as default};
