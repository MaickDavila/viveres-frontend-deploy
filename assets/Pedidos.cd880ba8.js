import{_ as e}from"./InputSearch.ebb45e5f.js";import{o,d as t,e as a,f as l,r,g as d,h as i,i as s,j as n,w as u,k as c,F as p,v,t as m,C as g,l as f,n as h,z as b,x,K as y,y as w}from"./vendor.f30c4ba5.js";import{_ as P,a as M,T as k}from"./DataTableComponent.c59f0328.js";import{t as U}from"./style.cc01f69b.js";import{i as F,u as I}from"./app.7dd6c994.js";import{u as _}from"./almacen.d7bdd88d.js";import{u as C}from"./proceso.cfe89160.js";import{u as D}from"./producto.0c062979.js";import{u as A}from"./unidad.cd342403.js";import{u as L}from"./utils.5428a5cd.js";const N={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",width:"1.2em",height:"1.2em",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 24 24"},B=[a("path",{d:"M22 17v2H11v-2h11M19 4.5v5h3L16.5 15L11 9.5h3v-5h5M10.7 15H8.8l-.7-2H4.9l-.7 2H2.3l3.2-9h2l3.2 9m-3.05-3.35L6.5 8l-1.15 3.65h2.3z",fill:"currentColor"},null,-1)];var T={name:"mdi-auto-download",render:function(e,a){return o(),t("svg",N,B)}};const V=l("pedidos",(()=>{const e="pedidos",o=r({}),t=r({}),a=r(1),l=d((()=>o.value.results)),i=d((()=>o.value.count)),s=d((()=>a.value)),n=d((()=>{const{Almacen:e,Usuario:o,Proceso:a}=t.value;return e>0&&o>0&&a>0}));return{keyModel:e,storeModel:t,getData:l,getCounts:i,getColumns:[{Key:"Id",Text:"Id",Width:10},{Key:"Proceso_Nombre",Text:"Proceso",Width:10},{Key:"Serie",Text:"Serie",Width:90},{Key:"Fecha",Text:"Fecha",Width:90},{Key:"Almacen_Nombre",Text:"Almacen",Width:90},{Key:"Usuario_Nombre",Text:"Usuario",Width:90}],getPageIndex:s,isValidFormModel:n,saveData:async()=>{try{if(!n.value)return null;let e=null;return e=t.value.id?await F.put(`pedidos/${t.value.id}/`,t.value):await F.post("pedidos/",t.value),e.data}catch(e){return console.error(e),null}},filterData:async e=>{try{const{data:t}=await F.get("filter_pedidos",{params:{text:e}});return o.value=t,t}catch(t){return console.error(t),null}},clearModel:()=>{t.value={}}}})),S=l("pedidos_detalles",(()=>{const e="pedidos_detalles",o=r([]),t=r({}),a=d((()=>o.value)),l=d((()=>o.value.length>0)),i=(e,t)=>o.value.findIndex((o=>o.Unidad===t&&o.Producto===e))>-1;return{keyModel:e,storeModel:t,storeData:o,getData:a,getColumns:[{Key:"Producto_Nombre",Text:"Producto",Width:10,Align:"left",FormatMoney:!1},{Key:"UnidadText",Text:"Unidad",Width:10,Align:"left",FormatMoney:!1},{Key:"Cantidad",Text:"Cantidad",Width:10,Align:"right",FormatMoney:!1}],isValidFormModel:l,saveData:async t=>{try{if(!l.value)return null;let a=(e=>o.value.filter((e=>(null==e?void 0:e.Id)>0)).map((o=>({id:o.Id,UnidadText:o.UnidadText,Factor:o.Factor,Cantidad:o.Cantidad,Pedido:e,Lote:o.Lote,Producto:o.Producto,Unidad:o.Unidad}))))(t),r=null;return a.length>0&&(r=await F.put(`${e}/`,a)),a=(e=>o.value.filter((e=>0===(null==e?void 0:e.Id))).map((o=>({id:0,UnidadText:o.UnidadText,Factor:o.Factor,Cantidad:o.Cantidad,Pedido:e,Lote:o.Lote,Producto:o.Producto,Unidad:o.Unidad}))))(t),a.length>0&&(r=await F.post(`${e}/`,a)),null==r?void 0:r.data}catch(a){return console.error(a),null}},ExistProductoUnidad:i,addList:e=>{try{if(i(e.Producto,e.Unidad))return!1;const t=o.value.findIndex((o=>o===e));return-1===t?o.value.push(e):o.value[t]=e,!0}catch(t){return!1}},deleteData:async t=>{try{let a=o.value.findIndex((e=>e===t));return a>-1&&t.Id>0&&await F.delete(`${e}/${t.Id}/`),a=o.value.findIndex((e=>e.Producto===t.Producto&&e.Unidad===t.Unidad)),a>-1&&o.value.splice(a,1),!0}catch(a){return console.error(a),!1}},setPedidosDetallesByPedidoId:async e=>{try{const{data:t}=await F.get("get_pedidos_detalles_by_pedido_id",{params:{pedidoId:e}});return o.value=t,t}catch(t){return console.error(t),null}},clearModel:()=>{t.value={},o.value=[]}}})),j=a("svg",{id:"Capa_1",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",x:"0px",y:"0px",width:"170",viewBox:"0 0 464.98 464.98",style:{"enable-background":"new 0 0 464.98 464.98"},"xml:space":"preserve"},[a("g",{id:"XMLID_4_"},[a("g",null,[a("polygon",{style:{fill:"#3A75AA"},points:"415.795,273.63 415.795,334.14 389.855,307.64 389.855,247.13"}),a("polygon",{style:{fill:"#3A75AA"},points:"156.745,9 188.975,41.93 87.355,41.93 87.355,73.37 49.185,73.37 49.185,9"}),a("polygon",{style:{fill:"#4489D3"},points:"415.795,436.01 415.795,455.98 49.185,455.98 49.185,82.37 156.735,82.37 415.795,347"}),a("polygon",{style:{fill:"#FFCC73"},points:"380.855,50.93 380.855,298.44 292.465,208.16 343.435,208.16 343.435,199.16\r\n283.655,199.16 248.005,162.73 343.435,162.73 343.435,153.73 239.185,153.73 203.545,117.32 343.435,117.32 343.435,108.32\r\n194.735,108.32 160.525,73.37 96.355,73.37 96.355,50.93"}),a("path",{d:"M424.795,343.34v121.64H40.185V0h120.34l41.05,41.93h188.28v192.33l34.94,35.7v73.37V343.34z M415.795,455.98v-19.97V347\r\nL156.735,82.37H49.185v373.61H415.795z M415.795,334.14v-60.51l-25.94-26.5v60.51L415.795,334.14z M380.855,298.44V50.93h-284.5\r\nv22.44h64.17l34.21,34.95h148.7v9h-139.89l35.64,36.41h104.25v9h-95.43l35.65,36.43h59.78v9h-50.97L380.855,298.44z\r\n M188.975,41.93L156.745,9H49.185v64.37h38.17V41.93H188.975z"})])]),a("g"),a("g"),a("g"),a("g"),a("g"),a("g"),a("g"),a("g"),a("g"),a("g"),a("g"),a("g"),a("g"),a("g"),a("g")],-1),E={class:"row-span-2"},K={class:"text-2xl font-semibold text-black uppercase"},H={class:"text-gray-500"},W={key:0,class:"text-xs text-red-500"},z={class:"h-[100%] w-full flex flex-col"},O={class:"row-span-1"},$=["onClick"],q={class:"bg-white h-full row-span-10 overflow-y-auto"},R={class:"form-container"},G=a("label",{for:"proceso",class:"form-label"},"Proceso",-1),X={key:0},Y=["value"],J={key:1,class:"w-full flex flex-col"},Q={class:"form-input w-full focus:text-black lg:w-[50%] bg-green-500 text-white"},Z={class:"form-container"},ee={key:0,class:"flex flex-col"},oe=a("label",{for:"almacen",class:"form-label"},"Almacen",-1),te=["value"],ae={key:1,class:"w-full flex flex-col"},le={class:"form-input w-full focus:text-black lg:w-[50%] bg-green-500 text-white"},re={class:"form-container"},de=a("label",{for:"observaciones",class:"form-label"},"Observaciones",-1),ie=["disabled"],se=a("input",{type:"submit",class:"hidden"},null,-1),ne={class:"relative flex w-full items-center row-span-1"},ue={class:"form-container"},ce=a("label",{for:"cantidad",class:"form-label"},"Cantidad",-1),pe=v(" Agregar "),ve={class:"rounded-xl overflow-auto bg-white row-span-4"},me=["onUpdate:modelValue"],ge={key:1,class:"bg-gray-200 p-2 rounded-lg text-gray-300",disabled:""},fe=i({setup(l){const d=V(),i=S(),F=_(),N=I(),B=C(),fe=D(),he=A(),be=L(),xe=r(!1),ye=r({}),we=r({}),Pe=r({}),Me=r(!1),ke=r(0),Ue=r(!1),Fe=r(0),Ie=["Productos del Pedido","Pedido"],_e=r(!1);s((()=>{d.filterData("")}));const Ce=e=>{d.filterData(e)},De=async()=>{Pe.value={},we.value={},d.clearModel(),i.clearModel(),F.setData(),he.setData();const e=await B.setProcesoActivo();if(!e)return U({title:"No tienes procesos disponibles",description:"Habra un proceso por favor! 👍😊"},{type:"info",hideProgressBar:!0,position:"bottom-right"}),void(xe.value=!1);we.value=e,await fe.filterProductoProcesoLote(we.value.id,""),d.storeModel.Proceso=e.id,d.storeModel.Usuario=N.getToken().user_id,Fe.value=0,be.setFocusInput("inputSearch")},Ae=async({Id:e,Serie:o,Almacen_Id:t,Almacen_Nombre:a,Usuario_Id:l,Fecha:r,Proceso_Id:s,Proceso_Nombre:n,Observaciones:u})=>{if(!e)return void(xe.value=!1);_e.value=!0,await F.setData(),he.setData();const c=await B.setProcesoActivo();(null==c?void 0:c.id)!==s&&(Me.value=!0),xe.value=!0,Pe.value={},we.value={},d.clearModel(),i.clearModel(),we.value.id=s,we.value.Nombre=n,d.storeModel.id=e,d.storeModel.Proceso=s,d.storeModel.Serie=o,d.storeModel.Almacen=t,d.storeModel.Usuario=l,d.storeModel.Fecha=r,d.storeModel.Observaciones=u;i.setPedidosDetallesByPedidoId(e)||U({title:"Ocurrio un problema",description:"El pedido no tiene ningun producto!"},{type:"danger",hideProgressBar:!0,position:"bottom-right"}),Pe.value.id=t,Pe.value.Nombre=a,Fe.value=0,be.setFocusInput("inputSearch"),_e.value=!1},Le=()=>d.isValidFormModel?i.isValidFormModel?void(Ue.value=!0):(U({title:"Formulario incompleto",description:"Por favor ingrese los productos al pedido"},{type:"info",hideProgressBar:!0,position:"bottom-right"}),void(Ue.value=!1)):(U({title:"Formulario incompleto",description:"Por favor completa todos los campos"},{type:"info",hideProgressBar:!0,position:"bottom-right"}),void(Ue.value=!1)),Ne=async()=>{if(_e.value=!0,!d.isValidFormModel)return void U({title:"Formulario incompleto",description:"Por favor completa todos los campos"},{type:"info",hideProgressBar:!0,position:"bottom-right"});if(!i.isValidFormModel)return void U({title:"Formulario incompleto",description:"Por favor ingrese los productos al pedido"},{type:"info",hideProgressBar:!0,position:"bottom-right"});const e=await d.saveData();if(!e)return void U({title:"Error al guardar",description:"Por favor intenta nuevamente"},{type:"danger",hideProgressBar:!0,position:"bottom-right"});await i.saveData(e.id)?(U({title:"Guardado",description:"Pedido guardado correctamente"},{type:"success",hideProgressBar:!0,position:"bottom-right"}),_e.value=xe.value=Ue.value=!1,d.filterData("")):U({title:"Error al guardar",description:"No se pudieron guardar los productos del pedido"},{type:"danger",hideProgressBar:!0,position:"bottom-right"})},Be=e=>{xe.value=e},Te=async e=>{await fe.filterProductoProcesoLote(we.value.id,e)},Ve=e=>{ye.value=e,setTimeout((()=>{be.setFocusInput("cantidad")}),100)},Se=async()=>{if(!ye.value.Id)return void U({title:"Seleccione un producto",description:"Por favor!"},{type:"info",hideProgressBar:!0,position:"bottom-right"});if(!ke.value)return void U({title:"Ingrese la cantidad",description:"Por favor!"},{type:"info",hideProgressBar:!0,position:"bottom-right"});const e={Id:0,Unidad:ye.value.Unidad,UnidadText:ye.value.Unidad_Nombre,Factor:ye.value.Factor,Cantidad:ke.value,Pedido:0,Lote:ye.value.Lote,Lote_Nombre:ye.value.Lote_Nombre,Producto:ye.value.Id,Producto_Nombre:ye.value.Producto_Nombre};if(i.ExistProductoUnidad(e.Producto,e.Unidad))return U({title:"El producto ya está en la lista!"},{type:"info",hideProgressBar:!0,position:"bottom-right"}),ye.value={},ke.value=0,void be.setFocusInput("inputSearch");i.addList(e)?(ye.value={},ke.value=0,be.setFocusButton("inputSearch")):U({title:"No se pudo agregar el producto"},{type:"info",hideProgressBar:!0,position:"bottom-right"})},je=e=>{"Enter"===e.key&&Se()},Ee=e=>{i.deleteData(e)};return(l,r)=>{const s=e,U=T,I=k,_=P,C=M;return o(),t(p,null,[n(_,{columns:c(d).getColumns,data:c(d).getData||[],count:c(d).getCounts,titulo:c(d).keyModel,subtitulo:`Listado de ${c(d).keyModel}`,"page-index":c(d).getPageIndex,"show-modal":xe.value,"modal-width":"50rem","modal-height":"90%","show-loading":_e.value,onAddEvent:De,onUpdateEvent:Ae,onFilterEvent:Ce,onModalIsOpen:Be},{imagen:u((()=>[j])),cabecera:u((()=>[a("div",E,[a("h1",K,[v(m(c(d).storeModel.id?"Editar":"Nuevo")+" "+m("Pedido")+" ",1),a("b",H,m(c(d).storeModel.id),1)]),Me.value?(o(),t("div",W," Registro de solo lectura ")):g("",!0)])])),cuerpo:u((()=>[a("div",z,[a("section",O,[(o(),t(p,null,f(Ie,((e,o)=>a("button",{key:o,class:h(["text-gray-600 focus:outline-none font-medium rounded-lg p-2 text-xs",{"border-green-500 border-b-2 shadow-lg transition  duration-300 ease-in-out transform hover:-translate-y-1 hover:scale-100":Fe.value===o," rounded-none rounded-r-lg":0==o}]),onClick:e=>Fe.value=o},m(e),11,$))),64))]),a("section",q,[a("form",{class:h(["form-container h-full p-3",1==Fe.value?"grid":"hidden"]),onSubmit:r[3]||(r[3]=b((()=>{}),["prevent"]))},[a("div",R,[G,Me.value?(o(),t("div",J,[a("span",Q,m(we.value.Nombre),1)])):(o(),t("div",X,[x(a("select",{id:"proceso","onUpdate:modelValue":r[0]||(r[0]=e=>c(d).storeModel.Proceso=e),class:"form-input w-full focus:text-black lg:w-[50%] bg-green-500 text-white",required:""},[(o(!0),t(p,null,f([we.value],((e,a)=>(o(),t("option",{key:a,value:e.id,class:"text-gray-700","aria-readonly":"true"},m(e.Nombre),9,Y)))),128))],512),[[y,c(d).storeModel.Proceso]])]))]),a("div",Z,[Me.value?(o(),t("div",ae,[a("span",le,m(Pe.value.Nombre),1)])):(o(),t("div",ee,[oe,x(a("select",{id:"almacen","onUpdate:modelValue":r[1]||(r[1]=e=>c(d).storeModel.Almacen=e),class:"form-input w-full focus:text-black lg:w-[50%] bg-green-500 text-white",required:""},[(o(!0),t(p,null,f(c(F).getData,((e,a)=>(o(),t("option",{key:a,value:e.id,class:"text-gray-700"},m(e.Nombre),9,te)))),128))],512),[[y,c(d).storeModel.Almacen]])]))]),a("div",re,[de,x(a("textarea",{id:"observaciones","onUpdate:modelValue":r[2]||(r[2]=e=>c(d).storeModel.Observaciones=e),class:"form-input w-full focus:text-black bg-white text-gray-500",disabled:Me.value},null,8,ie),[[w,c(d).storeModel.Observaciones]])]),se],34),a("section",{class:h(["form-container h-full p-3 grid grid-rows-5",0==Fe.value?"flex":"hidden"])},[a("div",ne,[n(s,{field:ye.value,"place-holder":"Buscar el producto",class:"w-[50%]",data:c(fe).getProductosProcesoLote,"column-label":"Producto_Nombre",onSelected:Ve,onSearch:Te},null,8,["field","data"]),a("div",ue,[ce,x(a("input",{id:"cantidad","onUpdate:modelValue":r[4]||(r[4]=e=>ke.value=e),class:"form-input w-full focus:text-black bg-white text-gray-500",type:"number",min:"0",step:"1",onKeydown:je},null,544),[[w,ke.value]])]),a("div",null,[a("button",{class:"btn-submit bg-white border border-blue-500 text-blue-500 text-xs flex gap-2",onClick:Se},[n(U),pe])])]),a("section",ve,[n(I,{columns:c(i).getColumns,data:c(i).storeData,actions:!0,class:"row-span-4","link-id":!1,onDeleteRow:Ee},{Cantidad:u((({index:e})=>[x(a("input",{"onUpdate:modelValue":o=>c(i).storeData[e].Cantidad=o,type:"number",class:"form-input text-center w-24"},null,8,me),[[w,c(i).storeData[e].Cantidad]])])),_:1},8,["columns","data"])])],2)])])])),acciones:u((()=>[Me.value?(o(),t("button",ge," Solo Lectura ")):(o(),t("button",{key:0,class:"btn-submit text-white font-bold py-2 px-4 rounded-lg",onClick:Le}," Guardar "))])),_:1},8,["columns","data","count","titulo","subtitulo","page-index","show-modal","show-loading"]),n(C,{"show-modal":Ue.value,"modal-width":"20rem","modal-height":"10rem",description:"Seguro que desea guardar los datos?",onConfirm:Ne,onCancel:r[5]||(r[5]=e=>Ue.value=!1)},null,8,["show-modal"])],64)}}});export{fe as default};
