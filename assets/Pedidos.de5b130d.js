import{_ as e}from"./InputSearch.be9bb5ed.js";import{_ as o}from"./auto-download.32fe4334.js";import{_ as t,a,b as l}from"./DataTableComponent.5369f172.js";import{h as r,r as s,i,o as d,d as n,j as u,w as c,k as p,F as v,e as m,v as g,t as f,C as b,l as h,n as w,z as x,x as y,J as P,y as M}from"./vendor.9b92c9a3.js";import{t as k}from"./style.d50ac2b4.js";import{u as F,a as _}from"./pedidosDetalles.4cb73277.js";import{u as C}from"./almacen.c6f7c2f7.js";import{u as D}from"./app.57d6f5c3.js";import{u as N}from"./proceso.9d74d721.js";import{u as B}from"./producto.99b65cfe.js";import{u as I}from"./utils.068ea219.js";const A=m("svg",{id:"Capa_1",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",x:"0px",y:"0px",width:"170",viewBox:"0 0 464.98 464.98",style:{"enable-background":"new 0 0 464.98 464.98"},"xml:space":"preserve"},[m("g",{id:"XMLID_4_"},[m("g",null,[m("polygon",{style:{fill:"#3A75AA"},points:"415.795,273.63 415.795,334.14 389.855,307.64 389.855,247.13"}),m("polygon",{style:{fill:"#3A75AA"},points:"156.745,9 188.975,41.93 87.355,41.93 87.355,73.37 49.185,73.37 49.185,9"}),m("polygon",{style:{fill:"#4489D3"},points:"415.795,436.01 415.795,455.98 49.185,455.98 49.185,82.37 156.735,82.37 415.795,347"}),m("polygon",{style:{fill:"#FFCC73"},points:"380.855,50.93 380.855,298.44 292.465,208.16 343.435,208.16 343.435,199.16\r\n283.655,199.16 248.005,162.73 343.435,162.73 343.435,153.73 239.185,153.73 203.545,117.32 343.435,117.32 343.435,108.32\r\n194.735,108.32 160.525,73.37 96.355,73.37 96.355,50.93"}),m("path",{d:"M424.795,343.34v121.64H40.185V0h120.34l41.05,41.93h188.28v192.33l34.94,35.7v73.37V343.34z M415.795,455.98v-19.97V347\r\nL156.735,82.37H49.185v373.61H415.795z M415.795,334.14v-60.51l-25.94-26.5v60.51L415.795,334.14z M380.855,298.44V50.93h-284.5\r\nv22.44h64.17l34.21,34.95h148.7v9h-139.89l35.64,36.41h104.25v9h-95.43l35.65,36.43h59.78v9h-50.97L380.855,298.44z\r\n M188.975,41.93L156.745,9H49.185v64.37h38.17V41.93H188.975z"})])]),m("g"),m("g"),m("g"),m("g"),m("g"),m("g"),m("g"),m("g"),m("g"),m("g"),m("g"),m("g"),m("g"),m("g"),m("g")],-1),U={class:"row-span-2"},L={class:"text-2xl font-semibold text-black uppercase"},V={class:"text-gray-500"},S={key:0,class:"text-xs text-red-500"},j={class:"h-[100%] w-full flex flex-col"},E={class:"row-span-1"},O=["onClick"],z={class:"bg-white row-span-10 overflow-y-auto h-full w-full"},H={class:"form-container"},T=m("label",{for:"proceso",class:"form-label"},"Proceso",-1),q={key:0},G=["value"],R={key:1,class:"w-full flex flex-col"},J={class:"form-input w-full focus:text-black lg:w-[50%] bg-green-500 text-white"},K={class:"form-container"},X={key:0,class:"flex flex-col"},$=m("label",{for:"almacen",class:"form-label"},"Almacen",-1),Q=["value"],W={key:1,class:"w-full flex flex-col"},Y={class:"form-input w-full focus:text-black lg:w-[50%] bg-green-500 text-white"},Z={class:"form-container"},ee=m("label",{for:"observaciones",class:"form-label"},"Observaciones",-1),oe=["disabled"],te=m("input",{type:"submit",class:"hidden"},null,-1),ae={class:"relative flex w-full items-center row-span-1"},le={class:"form-container"},re=m("label",{for:"cantidad",class:"form-label"},"Cantidad",-1),se=g(" Agregar "),ie={class:"rounded-xl overflow-auto bg-white row-span-4"},de=["onUpdate:modelValue"],ne={key:1,class:"bg-gray-200 p-2 rounded-lg text-gray-300",disabled:""},ue=r({setup(r){const ue=F(),ce=_(),pe=C(),ve=D(),me=N(),ge=B(),fe=I(),be=s(!1),he=s({}),we=s({}),xe=s({}),ye=s(!1),Pe=s(0),Me=s(!1),ke=s(0),Fe=["Productos del Pedido","Pedido"],_e=s(!1);i((()=>{ue.filterData("")}));const Ce=e=>{ue.filterData(e)},De=async()=>{xe.value={},we.value={},ue.clearModel(),ce.clearModel(),pe.setData();const e=await me.setProcesoActivo();if(!e)return k({title:"No tienes procesos disponibles",description:"Habra un proceso por favor! 👍😊"},{type:"info",hideProgressBar:!0,position:"bottom-right"}),void(be.value=!1);we.value=e,await ge.filterProductoProcesoLote(we.value.id,""),ue.storeModel.Proceso=e.id,ue.storeModel.Usuario=ve.getToken().user_id,ke.value=0,fe.setFocusInput("inputSearch")},Ne=async({Id:e,Serie:o,Almacen_Id:t,Almacen_Nombre:a,Usuario_Id:l,Fecha:r,Proceso_Id:s,Proceso_Nombre:i,Observaciones:d})=>{if(!e)return void(be.value=!1);_e.value=!0,await pe.setData();const n=await me.setProcesoActivo();(null==n?void 0:n.id)!==s&&(ye.value=!0),be.value=!0,xe.value={},we.value={},ue.clearModel(),ce.clearModel(),we.value.id=s,we.value.Nombre=i,ue.storeModel.id=e,ue.storeModel.Proceso=s,ue.storeModel.Serie=o,ue.storeModel.Almacen=t,ue.storeModel.Usuario=l,ue.storeModel.Fecha=r,ue.storeModel.Observaciones=d;ce.setPedidosDetallesByPedidoId(e)||k({title:"Ocurrio un problema",description:"El pedido no tiene ningun producto!"},{type:"danger",hideProgressBar:!0,position:"bottom-right"}),xe.value.id=t,xe.value.Nombre=a,ke.value=0,fe.setFocusInput("inputSearch"),_e.value=!1},Be=()=>ue.isValidFormModel?ce.isValidFormModel?void(Me.value=!0):(k({title:"Formulario incompleto",description:"Por favor ingrese los productos al pedido"},{type:"info",hideProgressBar:!0,position:"bottom-right"}),void(Me.value=!1)):(k({title:"Formulario incompleto",description:"Por favor completa todos los campos"},{type:"info",hideProgressBar:!0,position:"bottom-right"}),void(Me.value=!1)),Ie=async()=>{if(_e.value=!0,!ue.isValidFormModel)return void k({title:"Formulario incompleto",description:"Por favor completa todos los campos"},{type:"info",hideProgressBar:!0,position:"bottom-right"});if(!ce.isValidFormModel)return void k({title:"Formulario incompleto",description:"Por favor ingrese los productos al pedido"},{type:"info",hideProgressBar:!0,position:"bottom-right"});const e=await ue.saveData();if(!e)return void k({title:"Error al guardar",description:"Por favor intenta nuevamente"},{type:"danger",hideProgressBar:!0,position:"bottom-right"});await ce.saveData(e.id)?(k({title:"Guardado",description:"Pedido guardado correctamente"},{type:"success",hideProgressBar:!0,position:"bottom-right"}),_e.value=be.value=Me.value=!1,ue.filterData("")):k({title:"Error al guardar",description:"No se pudieron guardar los productos del pedido"},{type:"danger",hideProgressBar:!0,position:"bottom-right"})},Ae=e=>{be.value=e},Ue=async e=>{await ge.filterProductoProcesoLote(we.value.id,e)},Le=e=>{he.value=e,setTimeout((()=>{fe.setFocusInput("cantidad")}),100)},Ve=async()=>{if(!he.value.Id)return void k({title:"Seleccione un producto",description:"Por favor!"},{type:"info",hideProgressBar:!0,position:"bottom-right"});if(!Pe.value)return void k({title:"Ingrese la cantidad",description:"Por favor!"},{type:"info",hideProgressBar:!0,position:"bottom-right"});const e={Id:0,Unidad:he.value.Unidad,UnidadText:he.value.Unidad_Nombre,Factor:he.value.Factor,Cantidad:Pe.value,Pedido:0,Lote:he.value.Lote,Lote_Nombre:he.value.Lote_Nombre,Producto:he.value.Id,Producto_Nombre:he.value.Producto_Nombre};if(ce.ExistProductoUnidad(e.Producto,e.Unidad))return k({title:"El producto ya está en la lista!"},{type:"info",hideProgressBar:!0,position:"bottom-right"}),he.value={},Pe.value=0,void fe.setFocusInput("inputSearch");ce.addList(e)?(he.value={},Pe.value=0,fe.setFocusButton("inputSearch")):k({title:"No se pudo agregar el producto"},{type:"info",hideProgressBar:!0,position:"bottom-right"})},Se=e=>{"Enter"===e.key&&Ve()},je=e=>{ce.deleteData(e)};return(r,s)=>{const i=e,k=o,F=l,_=t,C=a;return d(),n(v,null,[u(_,{columns:p(ue).getColumns,data:p(ue).getData||[],count:p(ue).getCounts,titulo:p(ue).keyModel,subtitulo:`Listado de ${p(ue).keyModel}`,"page-index":p(ue).getPageIndex,"show-modal":be.value,"modal-width":"50rem","modal-height":"90%","show-loading":_e.value,onAddEvent:De,onUpdateEvent:Ne,onFilterEvent:Ce,onModalIsOpen:Ae},{imagen:c((()=>[A])),cabecera:c((()=>[m("div",U,[m("h1",L,[g(f(p(ue).storeModel.id?"Editar":"Nuevo")+" "+f("Pedido")+" ",1),m("b",V,f(p(ue).storeModel.id),1)]),ye.value?(d(),n("div",S," Registro de solo lectura ")):b("",!0)])])),cuerpo:c((()=>[m("div",j,[m("section",E,[(d(),n(v,null,h(Fe,((e,o)=>m("button",{key:o,class:w(["text-gray-600 focus:outline-none font-medium rounded-lg p-2 text-xs",{"border-green-500 border-b-2 shadow-lg transition  duration-300 ease-in-out transform hover:-translate-y-1 hover:scale-100":ke.value===o," rounded-none rounded-r-lg":0==o}]),onClick:e=>ke.value=o},f(e),11,O))),64))]),m("section",z,[m("form",{class:w(["form-container w-full h-full p-3",1==ke.value?"grid":"hidden"]),onSubmit:s[3]||(s[3]=x((()=>{}),["prevent"]))},[m("div",H,[T,ye.value?(d(),n("div",R,[m("span",J,f(we.value.Nombre),1)])):(d(),n("div",q,[y(m("select",{id:"proceso","onUpdate:modelValue":s[0]||(s[0]=e=>p(ue).storeModel.Proceso=e),class:"form-input w-full focus:text-black lg:w-[50%] bg-green-500 text-white",required:""},[(d(!0),n(v,null,h([we.value],((e,o)=>(d(),n("option",{key:o,value:e.id,class:"text-gray-700","aria-readonly":"true"},f(e.Nombre),9,G)))),128))],512),[[P,p(ue).storeModel.Proceso]])]))]),m("div",K,[ye.value?(d(),n("div",W,[m("span",Y,f(xe.value.Nombre),1)])):(d(),n("div",X,[$,y(m("select",{id:"almacen","onUpdate:modelValue":s[1]||(s[1]=e=>p(ue).storeModel.Almacen=e),class:"form-input w-full focus:text-black lg:w-[50%] bg-green-500 text-white",required:""},[(d(!0),n(v,null,h(p(pe).getData,((e,o)=>(d(),n("option",{key:o,value:e.id,class:"text-gray-700"},f(e.Nombre),9,Q)))),128))],512),[[P,p(ue).storeModel.Almacen]])]))]),m("div",Z,[ee,y(m("textarea",{id:"observaciones","onUpdate:modelValue":s[2]||(s[2]=e=>p(ue).storeModel.Observaciones=e),class:"form-input w-full focus:text-black bg-white text-gray-500",disabled:ye.value},null,8,oe),[[M,p(ue).storeModel.Observaciones]])]),te],34),m("section",{class:w(["form-container h-full p-3 grid grid-rows-5",0==ke.value?"flex":"hidden"])},[m("div",ae,[u(i,{field:he.value,"place-holder":"Buscar el producto",class:"w-[50%]",data:p(ge).getProductosProcesoLote,"column-label":"Producto_Nombre",onSelected:Le,onSearch:Ue},null,8,["field","data"]),m("div",le,[re,y(m("input",{id:"cantidad","onUpdate:modelValue":s[4]||(s[4]=e=>Pe.value=e),class:"form-input w-full focus:text-black bg-white text-gray-500",type:"number",min:"0",step:"1",onKeydown:Se},null,544),[[M,Pe.value]])]),m("div",null,[m("button",{class:"btn-submit bg-white border border-blue-500 text-blue-500 text-xs flex gap-2",onClick:Ve},[u(k),se])])]),m("section",ie,[u(F,{columns:p(ce).getColumns,data:p(ce).storeData,actions:!0,class:"row-span-4","link-id":!1,onDeleteRow:je},{Cantidad:c((({index:e})=>[y(m("input",{"onUpdate:modelValue":o=>p(ce).storeData[e].Cantidad=o,type:"number",class:"form-input text-center w-24"},null,8,de),[[M,p(ce).storeData[e].Cantidad]])])),_:1},8,["columns","data"])])],2)])])])),acciones:c((()=>[ye.value?(d(),n("button",ne," Solo Lectura ")):(d(),n("button",{key:0,class:"btn-submit text-white font-bold py-2 px-4 rounded-lg",onClick:Be}," Guardar "))])),_:1},8,["columns","data","count","titulo","subtitulo","page-index","show-modal","show-loading"]),u(C,{"show-modal":Me.value,"modal-width":"20rem","modal-height":"10rem",description:"Seguro que desea guardar los datos?",onConfirm:Ie,onCancel:s[5]||(s[5]=e=>Me.value=!1)},null,8,["show-modal"])],64)}}});export{ue as default};
