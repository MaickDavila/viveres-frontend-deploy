import{e as t,r as e,f as a}from"./vendor.a51b8ffa.js";import{i as r}from"./app.1c80cf5c.js";import{u as o}from"./utils.08d0e0c0.js";const d=t("notas",(()=>{const t="notas",d=e({}),n=e({Proceso:0}),l=e(1),u=a((()=>d.value.results)),s=a((()=>d.value.count)),i=a((()=>l.value)),c=a((()=>{const{Proceso:t,Lote:e}=n.value;return t>0&&e>0})),v=async()=>{try{const e=1===l.value||0===l.value?{}:{page:l.value},{data:a}=await r.get(t,{params:e});return d.value=a,a}catch(e){return console.error(e),null}},y=async t=>{try{const{data:e}=await r.get("filter_notas",{params:{text:t}});return d.value=e,e.results}catch(e){return console.error(e),null}},_=t=>{l.value=t,v()};return{keyModel:t,storeModel:n,getData:u,getCounts:s,getColumns:[{Key:"Id",Text:"Id",Width:10},{Key:"Proceso_Nombre",Text:"Proceso",Width:90},{Key:"Lote_Nombre",Text:"Lote",Width:90},{Key:"Serie",Text:"Serie",Width:10},{Key:"Fecha",Text:"Fecha",Width:10},{Key:"IsAceptado",Text:"AceptaciÃ³n",Width:10}],getPageIndex:i,isValidFormModel:c,setData:v,saveData:async()=>{try{if(!c.value)return null;let t=null;return t=n.value.id?await r.put(`notas/${n.value.id}/`,n.value):await r.post("notas/",n.value),y(""),t.data}catch(t){return console.error(t),null}},filterData:y,setById:async t=>{try{const{data:e}=await r.get(`notas/${t}/`);return e}catch(e){return console.error(e),null}},setPageIndex:_,setPrevius:()=>{l.value>1&&_(l.value-1)},setNext:()=>{const t=Math.abs(Math.ceil(s.value/o().CountPagination));l.value<t&&_(l.value+1)},clearModel:()=>{n.value={}}}})),n=t("notas_detalles",(()=>{const t="notas_detalles",o=e([]),d=e({}),n=a((()=>o.value)),l=a((()=>o.value.length>0)),u=(t,e)=>o.value.findIndex((a=>a.Unidad_Id===e&&a.Producto_Id===t))>-1;return{keyModel:t,storeModel:d,storeData:o,getData:n,getColumns:[{Key:"Producto_Nombre",Text:"Producto",Width:10,Align:"left",FormatMoney:!1},{Key:"Unidad_Nombre",Text:"Unidad",Width:10,Align:"left",FormatMoney:!1},{Key:"Cantidad",Text:"Cantidad",Width:10,Align:"right",FormatMoney:!1}],isValidFormModel:l,saveData:async e=>{try{if(!l.value)return null;let d=(a=e,o.value.filter((t=>(null==t?void 0:t.Id)>0)).map((t=>({id:t.Id,Nota:a,Producto:t.Producto_Id,Unidad:t.Unidad_Id,Cantidad:t.Cantidad,Factor:t.Factor})))),n=null;return d.length>0&&(n=await r.put(`${t}/`,d)),d=(t=>o.value.filter((t=>0===(null==t?void 0:t.Id))).map((e=>({id:0,Nota:t,Producto:e.Producto_Id,Unidad:e.Unidad_Id,Cantidad:e.Cantidad,Factor:e.Factor}))))(e),d.length>0&&(n=await r.post(`${t}/`,d)),null==n?void 0:n.data}catch(d){return console.error(d),null}var a},ExistProductoUnidad:u,addList:t=>{try{if(u(t.Producto_Id,t.Unidad_Id))return!1;const e=o.value.findIndex((e=>e===t));return-1===e?o.value.push(t):o.value[e]=t,!0}catch(e){return!1}},deleteData:async e=>{try{let a=o.value.findIndex((t=>t===e));return a>-1&&e.Id>0&&await r.delete(`${t}/${e.Id}/`),a=o.value.findIndex((t=>t.Producto_Id===e.Producto_Id&&t.Unidad_Id===e.Unidad_Id)),a>-1&&o.value.splice(a,1),!0}catch(a){return console.error(a),!1}},get_nota_detalles_by_nota_id:async t=>{try{const{data:e}=await r.get("get_nota_detalles_by_nota_id",{params:{notaId:t}});return o.value=e,e}catch(e){return console.error(e),null}},clearModel:()=>{d.value={},o.value=[]}}}));export{n as a,d as u};
